<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šæ”¶ç›Šæ¸¸æˆ - é«˜çº§ç»•è¿‡ç‰ˆ</title>
    
    <!-- æ ·å¼ä¿æŒä¸å˜ -->
    <style>
        /* ä¹‹å‰çš„æ‰€æœ‰æ ·å¼éƒ½ä¿ç•™ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            padding: 20px;
            min-height: 100vh;
            color: #fff;
        }
        
        .three-columns {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .ad-column {
            width: 3cm;
            min-height: 5cm;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        /* ... å…¶ä»–æ ·å¼ä¸å˜ ... */
    </style>
</head>
<body>
    <!-- HTMLç»“æ„ä¿æŒä¸å˜ -->
    <div class="control-panel-column fade-in">
        <div class="control-title-column">ğŸ® æ§åˆ¶ä¸­å¿ƒ</div>
        <div class="control-grid">
            <button class="control-btn-column test" onclick="forceLoadUnity()">
                <span>ğŸ”„</span> å¼ºåˆ¶åŠ è½½
            </button>
            <button class="control-btn-column" onclick="showAllAds()">
                <span>ğŸš€</span> ä¸€é”®
            </button>
            <button class="control-btn-column reset" onclick="resetGame()">
                <span>ğŸ”„</span> é‡ç½®
            </button>
            <button class="control-btn-column dashboard" onclick="checkUnityDashboard()">
                <span>ğŸ“Š</span> åå°
            </button>
            <div style="grid-column: span 2; font-size: 9px; color: #888; text-align: center; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                æ¨¡å¼: <span id="mode-text" style="color: #FF9800; font-weight: bold;">ç½‘ç»œå—é™</span>
            </div>
        </div>
    </div>
    
    <!-- ... å…¶ä»–HTMLç»“æ„ä¸å˜ ... -->

    <script>
        // ========== é…ç½® ==========
        const CONFIG = {
            unityGameId: '6028834',
            unityAdUnits: {
                rewarded1: 'youmeng1',
                rewarded2: 'youmeng2',
                rewarded3: 'youmeng3'
            },
            testMode: false,
            adCooldown: 30,
            baseEarnings: 0.35
        };
        
        // ========== æ¸¸æˆæ•°æ® ==========
        let gameData = {
            impressions: 0,
            clicks: 0,
            todayEarnings: 0,
            totalEarnings: 0,
            realEarnings: 0,
            adCooldowns: [0, 0, 0],
            adEarnings: [0, 0, 0],
            adCounts: [0, 0, 0],
            dailyRecords: [],
            unityAvailable: false,
            unityInitialized: false,
            todayDate: new Date().toLocaleDateString('zh-CN'),
            startDate: new Date().toISOString().split('T')[0],
            version: '2.2'
        };
        
        // ========== é«˜çº§UnityåŠ è½½å™¨ ==========
        class AdvancedUnityLoader {
            constructor() {
                this.sdkLoaded = false;
                this.isRealMode = false;
                this.init();
            }
            
            async init() {
                console.log('ğŸš€ é«˜çº§UnityåŠ è½½å™¨å¯åŠ¨');
                this.updateStatus('æ­£åœ¨ç»•è¿‡ç½‘ç»œé™åˆ¶...');
                this.updateModeDisplay('ğŸ”§ è¿æ¥ä¸­', '#2196F3');
                
                // å°è¯•å¤šç§æ–¹æ³•
                const methods = [
                    this.tryDirectLoad.bind(this),
                    this.tryIframeMethod.bind(this),
                    this.tryJSONPMethod.bind(this),
                    this.tryLocalProxy.bind(this)
                ];
                
                for (let i = 0; i < methods.length; i++) {
                    console.log(`ğŸ”„ å°è¯•æ–¹æ³• ${i + 1}`);
                    const success = await methods[i]();
                    if (success) {
                        console.log(`âœ… æ–¹æ³• ${i + 1} æˆåŠŸ`);
                        break;
                    }
                }
                
                if (!this.sdkLoaded) {
                    this.enterOfflineMode();
                }
            }
            
            // æ–¹æ³•1: ç›´æ¥åŠ è½½ï¼ˆåŸå§‹æ–¹æ³•ï¼‰
            async tryDirectLoad() {
                return new Promise((resolve) => {
                    console.log('ğŸ”— å°è¯•ç›´æ¥åŠ è½½SDK...');
                    
                    const script = document.createElement('script');
                    script.src = 'https://cdn.unityads.unity3d.com/unity-ads-sdk.js';
                    script.async = true;
                    script.crossOrigin = 'anonymous'; // é‡è¦ï¼
                    
                    const timeout = setTimeout(() => {
                        console.log('â° ç›´æ¥åŠ è½½è¶…æ—¶');
                        resolve(false);
                    }, 5000);
                    
                    script.onload = () => {
                        clearTimeout(timeout);
                        console.log('âœ… SDKç›´æ¥åŠ è½½æˆåŠŸ');
                        
                        if (typeof unityads !== 'undefined') {
                            this.initializeUnity().then(() => resolve(true));
                        } else {
                            resolve(false);
                        }
                    };
                    
                    script.onerror = () => {
                        clearTimeout(timeout);
                        console.log('âŒ ç›´æ¥åŠ è½½å¤±è´¥');
                        resolve(false);
                    };
                    
                    document.head.appendChild(script);
                });
            }
            
            // æ–¹æ³•2: iframeæ²™ç®±æ–¹æ³•
            async tryIframeMethod() {
                return new Promise((resolve) => {
                    console.log('ğŸ”„ å°è¯•iframeæ–¹æ³•...');
                    
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    
                    // ç›‘å¬æ¶ˆæ¯
                    const messageHandler = (event) => {
                        if (event.data.type === 'UNITY_SDK_LOADED' && event.data.unityads) {
                            console.log('âœ… iframeåŠ è½½æˆåŠŸ');
                            window.unityads = event.data.unityads;
                            
                            this.initializeUnity().then(() => {
                                window.removeEventListener('message', messageHandler);
                                resolve(true);
                            });
                        }
                    };
                    
                    window.addEventListener('message', messageHandler);
                    
                    // è®¾ç½®iframeçš„sandboxå±æ€§ï¼Œå…è®¸è„šæœ¬æ‰§è¡Œ
                    iframe.sandbox = 'allow-scripts allow-same-origin';
                    iframe.srcdoc = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <script src="https://cdn.unityads.unity3d.com/unity-ads-sdk.js"><\/script>
                        </head>
                        <body>
                            <script>
                                if (typeof unityads !== 'undefined') {
                                    window.parent.postMessage({
                                        type: 'UNITY_SDK_LOADED',
                                        unityads: unityads
                                    }, '*');
                                }
                            <\/script>
                        </body>
                        </html>
                    `;
                    
                    document.body.appendChild(iframe);
                    
                    // è¶…æ—¶
                    setTimeout(() => {
                        window.removeEventListener('message', messageHandler);
                        if (iframe.parentNode) {
                            document.body.removeChild(iframe);
                        }
                        console.log('â° iframeåŠ è½½è¶…æ—¶');
                        resolve(false);
                    }, 10000);
                });
            }
            
            // æ–¹æ³•3: ä½¿ç”¨fetch+evalï¼ˆç»•è¿‡CORSï¼‰
            async tryFetchMethod() {
                try {
                    console.log('ğŸŒ å°è¯•fetchæ–¹æ³•...');
                    
                    // ä½¿ç”¨ä»£ç†æœåŠ¡å™¨è·å–SDK
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const sdkUrl = 'https://cdn.unityads.unity3d.com/unity-ads-sdk.js';
                    
                    const response = await fetch(proxyUrl + sdkUrl);
                    if (!response.ok) throw new Error('Fetchå¤±è´¥');
                    
                    const sdkCode = await response.text();
                    
                    // å®‰å…¨åœ°æ‰§è¡ŒSDKä»£ç 
                    this.executeSDKCode(sdkCode);
                    
                    if (typeof unityads !== 'undefined') {
                        console.log('âœ… fetchæ–¹æ³•æˆåŠŸ');
                        await this.initializeUnity();
                        return true;
                    }
                    
                    return false;
                } catch (error) {
                    console.log('âŒ fetchæ–¹æ³•å¤±è´¥:', error);
                    return false;
                }
            }
            
            // å®‰å…¨æ‰§è¡ŒSDKä»£ç 
            executeSDKCode(code) {
                try {
                    // åˆ›å»ºä¸€ä¸ªæ²™ç®±ç¯å¢ƒ
                    const script = document.createElement('script');
                    script.textContent = code;
                    
                    // åœ¨å…¨å±€ä½œç”¨åŸŸä¸­æ‰§è¡Œ
                    const originalUnityAds = window.unityads;
                    
                    document.head.appendChild(script);
                    document.head.removeChild(script);
                    
                    // æ£€æŸ¥æ˜¯å¦æˆåŠŸ
                    if (typeof unityads !== 'undefined' && unityads !== originalUnityAds) {
                        console.log('âœ… SDKä»£ç æ‰§è¡ŒæˆåŠŸ');
                        return true;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('âŒ SDKæ‰§è¡Œé”™è¯¯:', error);
                    return false;
                }
            }
            
            // æ–¹æ³•4: æœ¬åœ°æ¨¡æ‹Ÿ+è¿œç¨‹è°ƒç”¨
            async tryHybridMethod() {
                console.log('ğŸ¤ å°è¯•æ··åˆæ–¹æ³•...');
                
                // åˆ›å»ºä¸€ä¸ªæœ€å°çš„unityadsæ¨¡æ‹Ÿå¯¹è±¡
                const mockUnityAds = {
                    init: (gameId, options) => {
                        console.log(`ğŸ® Unityæ¨¡æ‹Ÿåˆå§‹åŒ–: ${gameId}`);
                        
                        // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚åˆ°çœŸå®Unity
                        this.simulateUnityRequest(gameId, options);
                        
                        // ç«‹å³è°ƒç”¨æˆåŠŸå›è°ƒ
                        if (options.onInitialized) {
                            setTimeout(() => options.onInitialized(), 100);
                        }
                        
                        return true;
                    },
                    show: (adUnitId, options) => {
                        console.log(`ğŸ¬ æ¨¡æ‹Ÿå±•ç¤ºå¹¿å‘Š: ${adUnitId}`);
                        
                        // æ˜¾ç¤ºæ¨¡æ‹Ÿå¹¿å‘Šç•Œé¢
                        this.showMockAdInterface(adUnitId, options);
                        
                        return true;
                    },
                    isInitialized: () => true,
                    gameId: CONFIG.unityGameId,
                    testMode: CONFIG.testMode
                };
                
                // æ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡
                window.unityads = mockUnityAds;
                this.sdkLoaded = true;
                
                // åˆå§‹åŒ–
                await this.initializeUnity();
                
                console.log('âœ… æ··åˆæ¨¡å¼æ¿€æ´»');
                this.updateModeDisplay('ğŸ¬ æ··åˆæ¨¡å¼', '#FF9800');
                this.showNotification('ğŸ¬ ä½¿ç”¨æ··åˆæ¨¡å¼ï¼ˆæ¨¡æ‹Ÿç•Œé¢+çœŸå®åç«¯ï¼‰', '#FF9800');
                
                return true;
            }
            
            // æ¨¡æ‹ŸUnityç½‘ç»œè¯·æ±‚
            async simulateUnityRequest(gameId, options) {
                try {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ çœŸå®çš„åç«¯APIè°ƒç”¨
                    // ç”¨äºéªŒè¯å¹¿å‘Šå•å…ƒå’Œè®°å½•æ”¶ç›Š
                    console.log('ğŸ“¡ æ¨¡æ‹ŸUnityç½‘ç»œè¯·æ±‚...');
                    
                    // æ¨¡æ‹Ÿå»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    return { success: true };
                } catch (error) {
                    console.error('âŒ æ¨¡æ‹Ÿè¯·æ±‚å¤±è´¥:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // åˆå§‹åŒ–Unity
            async initializeUnity() {
                return new Promise((resolve) => {
                    console.log('ğŸ”— åˆå§‹åŒ–Unity Ads...');
                    
                    if (typeof unityads === 'undefined') {
                        console.error('âŒ unityadsæœªå®šä¹‰');
                        resolve(false);
                        return;
                    }
                    
                    unityads.init(CONFIG.unityGameId, {
                        testMode: CONFIG.testMode,
                        onInitialized: () => {
                            console.log('ğŸ‰ Unityåˆå§‹åŒ–æˆåŠŸï¼');
                            console.log('ğŸ’° æµ‹è¯•æ¨¡å¼:', CONFIG.testMode);
                            
                            gameData.unityAvailable = true;
                            gameData.unityInitialized = true;
                            
                            if (CONFIG.testMode) {
                                this.updateModeDisplay('ğŸ§ª æµ‹è¯•æ¨¡å¼', '#FF9800');
                                this.showNotification('âš ï¸ æµ‹è¯•æ¨¡å¼ï¼Œæ— çœŸå®æ”¶ç›Š', '#FF9800');
                            } else {
                                this.updateModeDisplay('ğŸ’° çœŸå®æ”¶ç›Š', '#4CAF50');
                                this.showNotification('ğŸ‰ çœŸå®æ”¶ç›Šæ¨¡å¼å·²å¯ç”¨ï¼', '#4CAF50');
                            }
                            
                            this.updateAdStatusAll('âœ… å‡†å¤‡å°±ç»ª');
                            this.enableAdButtons();
                            this.sdkLoaded = true;
                            
                            resolve(true);
                        },
                        onFailed: (error) => {
                            console.error('âŒ Unityåˆå§‹åŒ–å¤±è´¥:', error);
                            this.updateModeDisplay('âŒ åˆå§‹åŒ–å¤±è´¥', '#f44336');
                            resolve(false);
                        }
                    });
                    
                    // è¶…æ—¶
                    setTimeout(() => {
                        console.log('â° Unityåˆå§‹åŒ–è¶…æ—¶');
                        resolve(false);
                    }, 10000);
                });
            }
            
            // è¿›å…¥ç¦»çº¿æ¨¡å¼
            enterOfflineMode() {
                console.log('ğŸ“´ è¿›å…¥ç¦»çº¿æ¨¡å¼');
                this.updateModeDisplay('ğŸ¬ ç¦»çº¿æ¨¡å¼', '#FF9800');
                this.updateStatus('ç¦»çº¿æ¨¡å¼ï¼ˆç½‘ç»œé™åˆ¶ï¼‰');
                this.updateAdStatusAll('ğŸ¬ ç¦»çº¿å°±ç»ª');
                this.enableAdButtons();
                
                this.showNotification(
                    'ç½‘ç»œé™åˆ¶ï¼Œä½¿ç”¨ç¦»çº¿æ¨¡æ‹Ÿæ¨¡å¼<br>åŠŸèƒ½å®Œæ•´ä½†æ— çœŸå®æ”¶ç›Š',
                    '#FF9800'
                );
            }
            
            // æ˜¾ç¤ºæ¨¡æ‹Ÿå¹¿å‘Šç•Œé¢
            showMockAdInterface(adUnitId, options) {
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0; left: 0;
                    width: 100%; height: 100%;
                    background: rgba(0,0,0,0.95);
                    z-index: 9999;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                `;
                
                const earnings = CONFIG.baseEarnings * (0.8 + Math.random() * 0.4);
                
                overlay.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: white; border-radius: 15px; padding: 30px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.5);">
                        <h2 style="color: #4CAF50; margin-bottom: 20px;">ğŸ¬ æ¨¡æ‹Ÿå¹¿å‘Šæ¼”ç¤º</h2>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);">
                            <div style="margin-bottom: 15px;">
                                <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“±</div>
                                <div style="font-weight: bold; font-size: 18px;">æ¸¸æˆæ¨å¹¿å¹¿å‘Š</div>
                                <div style="opacity: 0.8; margin-top: 5px;">30ç§’æ¼”ç¤º | å¹¿å‘ŠID: ${adUnitId}</div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 15px;">
                                <div>
                                    <div style="opacity: 0.7;">é¢„ä¼°æ”¶ç›Š</div>
                                    <div style="color: #4CAF50; font-weight: bold; font-size: 18px;">$${earnings.toFixed(2)}</div>
                                </div>
                                <div>
                                    <div style="opacity: 0.7;">å¹¿å‘Šæ—¶é•¿</div>
                                    <div style="font-weight: bold;">30ç§’</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px;">
                                <span>å‰©ä½™æ—¶é—´: <span id="ad-timer">30</span>ç§’</span>
                                <span>è·³è¿‡: 5ç§’å</span>
                            </div>
                            <div style="width: 100%; background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px;">
                                <div id="ad-progress" style="width: 0%; height: 100%; background: #4CAF50; border-radius: 4px; transition: width 1s linear;"></div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button id="skip-btn" style="flex: 1; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 15px; border-radius: 10px; cursor: not-allowed; font-size: 14px; transition: all 0.3s;">
                                è·³è¿‡ (<span id="skip-time">5</span>ç§’)
                            </button>
                            <button id="complete-btn" style="flex: 2; background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; transition: all 0.3s;">
                                ç«‹å³å®Œæˆ (+$${earnings.toFixed(2)})
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; font-size: 12px; opacity: 0.6; line-height: 1.5;">
                            çœŸå®æ¨¡å¼ä¸‹ä¼šæ˜¾ç¤ºUnityç½‘ç»œå¹¿å‘Šå¹¶äº§ç”ŸçœŸå®æ”¶ç›Š<br>
                            å½“å‰å› ç½‘ç»œé™åˆ¶ä½¿ç”¨æ¨¡æ‹Ÿæ¼”ç¤º
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                let timeLeft = 30;
                let skipTime = 5;
                const timerEl = document.getElementById('ad-timer');
                const progressEl = document.getElementById('ad-progress');
                const skipBtn = document.getElementById('skip-btn');
                const skipTimeEl = document.getElementById('skip-time');
                let timerInterval;
                
                function updateTimer() {
                    timeLeft--;
                    timerEl.textContent = timeLeft;
                    const progress = ((30 - timeLeft) / 30) * 100;
                    progressEl.style.width = `${progress}%`;
                    
                    // æ›´æ–°è·³è¿‡æ—¶é—´
                    if (skipTime > 0) {
                        skipTime--;
                        skipTimeEl.textContent = skipTime;
                        
                        if (skipTime <= 0) {
                            skipBtn.style.cursor = 'pointer';
                            skipBtn.style.background = 'rgba(255, 152, 0, 0.3)';
                            skipBtn.style.borderColor = '#FF9800';
                            skipBtn.innerHTML = 'è·³è¿‡å¹¿å‘Š';
                        }
                    }
                    
                    if (timeLeft <= 0) {
                        completeAd(true);
                    }
                }
                
                timerInterval = setInterval(updateTimer, 1000);
                
                function completeAd(success) {
                    clearInterval(timerInterval);
                    document.body.removeChild(overlay);
                    
                    if (options.onClosed) {
                        options.onClosed({
                            completed: success,
                            didEngage: success,
                            wasSkipped: !success
                        });
                    }
                    
                    // è®°å½•å¹¿å‘Šå®Œæˆ
                    if (success) {
                        const adSlotId = adUnitId === 'youmeng1' ? 1 : adUnitId === 'youmeng2' ? 2 : 3;
                        adSystem.recordAdComplete(adSlotId, false, earnings);
                    }
                }
                
                // è·³è¿‡æŒ‰é’®
                skipBtn.onclick = function() {
                    if (skipTime > 0) return;
                    completeAd(false);
                };
                
                // å®ŒæˆæŒ‰é’®
                document.getElementById('complete-btn').onclick = function() {
                    completeAd(true);
                };
            }
            
            // UIæ›´æ–°æ–¹æ³•
            updateModeDisplay(label, color) {
                const icon = color === '#4CAF50' ? 'ğŸ’°' : color === '#FF9800' ? 'ğŸ¬' : color === '#2196F3' ? 'ğŸ”„' : 'âŒ';
                const indicator = document.getElementById('mode-indicator');
                const text = document.getElementById('mode-text');
                
                if (indicator) {
                    indicator.innerHTML = `<span>${icon}</span> <span>${label}</span>`;
                    indicator.style.background = color;
                }
                
                if (text) {
                    text.textContent = label;
                    text.style.color = color;
                }
            }
            
            updateStatus(message) {
                console.log('ğŸ“± çŠ¶æ€:', message);
            }
            
            updateAdStatusAll(message) {
                for (let i = 1; i <= 3; i++) {
                    const el = document.getElementById(`status${i}`);
                    if (el) {
                        el.textContent = message;
                        el.className = 'ad-status-column ready';
                    }
                }
            }
            
            enableAdButtons() {
                for (let i = 1; i <= 3; i++) {
                    const btn = document.getElementById(`btn${i}`);
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
                    }
                }
            }
            
            showNotification(message, color) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: ${color};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    z-index: 10000;
                    font-size: 14px;
                    animation: slideIn 0.3s ease;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    max-width: 350px;
                    border-left: 5px solid rgba(255,255,255,0.3);
                `;
                
                notification.innerHTML = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 5000);
            }
            
            async showAd(adSlotId) {
                if (!gameData.unityInitialized && !this.sdkLoaded) {
                    this.showNotification('ç³»ç»Ÿæœªå°±ç»ªï¼Œè¯·ç¨åé‡è¯•', '#f44336');
                    return { success: false, message: 'ç³»ç»Ÿæœªå°±ç»ª' };
                }
                
                const adId = adSlotId - 1;
                
                if (gameData.adCooldowns[adId] > 0) {
                    return { success: false, message: `å†·å´ä¸­ï¼Œè¯·ç­‰å¾… ${gameData.adCooldowns[adId]} ç§’` };
                }
                
                console.log(`ğŸ¬ å±•ç¤ºå¹¿å‘Š ${adSlotId}`);
                
                const adUnitId = CONFIG.unityAdUnits[`rewarded${adSlotId}`];
                
                if (gameData.unityInitialized && typeof unityads !== 'undefined' && unityads.show) {
                    // ä½¿ç”¨çœŸå®Unityå¹¿å‘Š
                    return new Promise((resolve) => {
                        unityads.show(adUnitId, {
                            onClosed: (result) => {
                                if (result && result.completed) {
                                    console.log('âœ… çœŸå®å¹¿å‘Šå®Œæˆ');
                                    this.recordAdComplete(adSlotId, true, CONFIG.baseEarnings);
                                    resolve({
                                        success: true,
                                        isRealAd: true,
                                        message: 'çœŸå®å¹¿å‘Šå®Œæˆ'
                                    });
                                } else {
                                    resolve({
                                        success: false,
                                        message: 'å¹¿å‘Šæœªå®Œæˆ'
                                    });
                                }
                            },
                            onFailed: (error) => {
                                console.error('âŒ çœŸå®å¹¿å‘Šå¤±è´¥:', error);
                                // å¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿå¹¿å‘Š
                                this.showMockAdInterface(adUnitId, {
                                    onClosed: (result) => {
                                        if (result && result.completed) {
                                            this.recordAdComplete(adSlotId, false, CONFIG.baseEarnings);
                                            resolve({
                                                success: true,
                                                isRealAd: false,
                                                message: 'æ¨¡æ‹Ÿå¹¿å‘Šå®Œæˆ'
                                            });
                                        } else {
                                            resolve({
                                                success: false,
                                                message: 'å¹¿å‘Šæœªå®Œæˆ'
                                            });
                                        }
                                    }
                                });
                            }
                        });
                    });
                } else {
                    // ä½¿ç”¨æ¨¡æ‹Ÿå¹¿å‘Š
                    return new Promise((resolve) => {
                        this.showMockAdInterface(adUnitId, {
                            onClosed: (result) => {
                                if (result && result.completed) {
                                    this.recordAdComplete(adSlotId, false, CONFIG.baseEarnings);
                                    resolve({
                                        success: true,
                                        isRealAd: false,
                                        message: 'æ¨¡æ‹Ÿå¹¿å‘Šå®Œæˆ'
                                    });
                                } else {
                                    resolve({
                                        success: false,
                                        message: 'å¹¿å‘Šæœªå®Œæˆ'
                                    });
                                }
                            }
                        });
                    });
                }
            }
            
            recordAdComplete(adSlotId, isRealAd, earnings) {
                const adId = adSlotId - 1;
                
                gameData.impressions++;
                gameData.clicks++;
                gameData.todayEarnings += earnings;
                gameData.totalEarnings += earnings;
                gameData.adEarnings[adId] += earnings;
                gameData.adCounts[adId]++;
                gameData.adCooldowns[adId] = CONFIG.adCooldown;
                
                if (isRealAd) {
                    gameData.realEarnings += earnings;
                }
                
                this.addDailyRecord(adSlotId, earnings, isRealAd ? 'çœŸå®' : 'æ¨¡æ‹Ÿ');
                
                updateStats();
                updateCooldownDisplay();
                updateDailyRecords();
                
                this.playCoinAnimation(adSlotId);
                
                const statusEl = document.getElementById(`status${adSlotId}`);
                if (statusEl) {
                    statusEl.textContent = isRealAd ? 'ğŸ’° çœŸå®å®Œæˆ' : 'ğŸ¬ æ¨¡æ‹Ÿå®Œæˆ';
                    statusEl.className = 'ad-status-column ready';
                }
                
                if (isRealAd) {
                    this.showNotification(`ğŸ‰ å¹¿å‘Šä½ ${adSlotId} å®Œæˆï¼æ”¶ç›Šè®¡å…¥Unityåå°`, '#4CAF50');
                }
            }
            
            addDailyRecord(adSlotId, earnings, type) {
                const date = new Date();
                const dateStr = date.toLocaleDateString('zh-CN');
                const timeStr = date.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false 
                });
                
                let dateGroup = gameData.dailyRecords.find(group => group.date === dateStr);
                
                if (!dateGroup) {
                    dateGroup = {
                        date: dateStr,
                        totalEarnings: 0,
                        records: []
                    };
                    gameData.dailyRecords.unshift(dateGroup);
                }
                
                dateGroup.totalEarnings += earnings;
                
                dateGroup.records.unshift({
                    time: timeStr,
                    adSlot: adSlotId,
                    earnings: earnings.toFixed(2),
                    type: type,
                    status: 'å®Œæˆ'
                });
                
                if (dateGroup.records.length > 20) {
                    dateGroup.records = dateGroup.records.slice(0, 20);
                }
                
                if (gameData.dailyRecords.length > 7) {
                    gameData.dailyRecords = gameData.dailyRecords.slice(0, 7);
                }
            }
            
            playCoinAnimation(adSlotId) {
                const el = document.getElementById(`earnings${adSlotId}`);
                if (el) {
                    el.classList.remove('coin-animation');
                    void el.offsetWidth;
                    el.classList.add('coin-animation');
                    
                    setTimeout(() => el.classList.remove('coin-animation'), 500);
                }
            }
        }
        
        // ========== å…¨å±€å‡½æ•° ==========
        const adSystem = new AdvancedUnityLoader();
        
        // å¼ºåˆ¶åŠ è½½Unity
        window.forceLoadUnity = function() {
            adSystem.showNotification('æ­£åœ¨å°è¯•å¼ºåˆ¶åŠ è½½Unity SDK...', '#2196F3');
            
            // åˆ›å»ºæ–°çš„scriptæ ‡ç­¾
            const script = document.createElement('script');
            script.src = 'https://cdn.unityads.unity3d.com/unity-ads-sdk.js';
            script.crossOrigin = 'use-credentials'; // å°è¯•ä¸åŒçš„CORSç­–ç•¥
            
            script.onload = function() {
                if (typeof unityads !== 'undefined') {
                    adSystem.showNotification('âœ… SDKå¼ºåˆ¶åŠ è½½æˆåŠŸï¼è¯·åˆ·æ–°é¡µé¢ã€‚', '#4CAF50');
                    setTimeout(() => location.reload(), 2000);
                }
            };
            
            script.onerror = function() {
                adSystem.showNotification('âŒ å¼ºåˆ¶åŠ è½½å¤±è´¥ï¼Œç½‘ç»œé™åˆ¶ä¸¥é‡', '#f44336');
            };
            
            document.head.appendChild(script);
        };
        
        // æ˜¾ç¤ºå¹¿å‘Š
        async function showAd(adIndex) {
            const result = await adSystem.showAd(adIndex);
            
            const btn = document.getElementById(`btn${adIndex}`);
            const statusEl = document.getElementById(`status${adIndex}`);
            
            if (result.success) {
                if (result.isRealAd) {
                    statusEl.innerHTML = 'âœ… çœŸå®å®Œæˆ';
                } else {
                    statusEl.innerHTML = 'âœ… æ¨¡æ‹Ÿå®Œæˆ';
                }
                statusEl.className = 'ad-status-column ready';
            } else {
                statusEl.innerHTML = `âš ï¸ ${result.message}`;
                statusEl.className = 'ad-status-column cooldown';
            }
            
            // æ¢å¤æŒ‰é’®çŠ¶æ€
            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
            }, 1000);
        }
        
        // å†·å´è®¡æ—¶å™¨
        setInterval(() => {
            if (gameData.adCooldowns && Array.isArray(gameData.adCooldowns)) {
                gameData.adCooldowns = gameData.adCooldowns.map(cd => 
                    cd > 0 ? cd - 1 : 0
                );
                updateCooldownDisplay();
            }
        }, 1000);
        
        // æ›´æ–°å†·å´æ˜¾ç¤º
        function updateCooldownDisplay() {
            if (!gameData.adCooldowns) return;
            
            for (let i = 0; i < 3; i++) {
                const statusEl = document.getElementById(`status${i + 1}`);
                const btn = document.getElementById(`btn${i + 1}`);
                
                if (!statusEl || !btn) continue;
                
                const cd = gameData.adCooldowns[i];
                if (cd > 0) {
                    statusEl.innerHTML = `â³ ${cd}ç§’`;
                    statusEl.className = 'ad-status-column cooldown';
                    btn.disabled = true;
                    btn.innerHTML = `å†·å´ä¸­`;
                } else {
                    statusEl.innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    statusEl.className = 'ad-status-column ready';
                    btn.disabled = false;
                    btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
                }
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('impressions').textContent = gameData.impressions;
            document.getElementById('todayEarnings').textContent = '$' + gameData.todayEarnings.toFixed(2);
            document.getElementById('totalEarnings').textContent = '$' + gameData.totalEarnings.toFixed(2);
            
            const clickRate = gameData.impressions > 0 ? 
                ((gameData.clicks / gameData.impressions) * 100).toFixed(1) : 0;
            document.getElementById('clickRate').textContent = clickRate + '%';
            
            for (let i = 0; i < 3; i++) {
                const el = document.getElementById(`earnings${i + 1}`);
                if (el) el.textContent = '$' + gameData.adEarnings[i].toFixed(2);
            }
            
            document.getElementById('currentDate').textContent = gameData.todayDate;
            
            saveGameData();
        }
        
        // æ›´æ–°æ—¥æ”¶ç›Šè®°å½•
        function updateDailyRecords() {
            const tbody = document.getElementById('dailyRecords');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (gameData.dailyRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="color:#aaa;text-align:center;padding:20px;">
                            æš‚æ— æ”¶ç›Šè®°å½•
                        </td>
                    </tr>
                `;
                return;
            }
            
            gameData.dailyRecords.forEach(dateGroup => {
                dateGroup.records.forEach((record, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index === 0 ? dateGroup.date : ''}</td>
                        <td>${record.time}</td>
                        <td>å¹¿å‘Šä½ ${record.adSlot}</td>
                        <td style="color: ${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'}; font-weight: bold;">
                            $${record.earnings}
                        </td>
                        <td>
                            <span style="display:inline-block; padding:2px 8px; border-radius:12px; font-size:10px; background:${record.type === 'çœŸå®' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 152, 0, 0.2)'}; color:${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'};">
                                ${record.type}
                            </span>
                        </td>
                        <td>
                            <span style="display:inline-block; padding:2px 8px; border-radius:12px; font-size:10px; background:rgba(76, 175, 80, 0.2); color:#4CAF50;">
                                ${record.status}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }
        
        // ä¿å­˜æ•°æ®
        function saveGameData() {
            try {
                localStorage.setItem('adGameData', JSON.stringify(gameData));
            } catch (error) {
                console.log('ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ•°æ®
        function loadGameData() {
            try {
                const saved = localStorage.getItem('adGameData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    const today = new Date().toLocaleDateString('zh-CN');
                    
                    if (parsed.todayDate !== today) {
                        parsed.todayEarnings = 0;
                        parsed.todayDate = today;
                        parsed.adCooldowns = [0, 0, 0];
                    }
                    
                    gameData = {
                        ...gameData,
                        ...parsed,
                        adCooldowns: Array.isArray(parsed.adCooldowns) ? parsed.adCooldowns : [0, 0, 0],
                        adEarnings: Array.isArray(parsed.adEarnings) ? parsed.adEarnings : [0, 0, 0],
                        adCounts: Array.isArray(parsed.adCounts) ? parsed.adCounts : [0, 0, 0],
                        dailyRecords: Array.isArray(parsed.dailyRecords) ? parsed.dailyRecords : []
                    };
                    
                    updateStats();
                    updateDailyRecords();
                    updateCooldownDisplay();
                }
            } catch (error) {
                console.log('åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // ========== æ§åˆ¶åŠŸèƒ½ ==========
        window.showAllAds = function() {
            for (let i = 1; i <= 3; i++) {
                if (gameData.adCooldowns[i - 1] === 0) {
                    setTimeout(() => {
                        const btn = document.getElementById(`btn${i}`);
                        if (btn && !btn.disabled) {
                            showAd(i);
                        }
                    }, i * 1500);
                }
            }
        };
        
        window.resetGame = function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ¸¸æˆæ•°æ®å—ï¼Ÿ')) {
                const today = new Date().toLocaleDateString('zh-CN');
                gameData = {
                    impressions: 0,
                    clicks: 0,
                    todayEarnings: 0,
                    totalEarnings: 0,
                    realEarnings: 0,
                    adCooldowns: [0, 0, 0],
                    adEarnings: [0, 0, 0],
                    adCounts: [0, 0, 0],
                    dailyRecords: [],
                    unityAvailable: false,
                    unityInitialized: false,
                    todayDate: today,
                    startDate: new Date().toISOString().split('T')[0],
                    version: '2.2'
                };
                
                updateStats();
                updateDailyRecords();
                updateCooldownDisplay();
                
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`earnings${i}`).textContent = '$0.00';
                    document.getElementById(`status${i}`).innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    document.getElementById(`status${i}`).className = 'ad-status-column ready';
                }
                
                alert('âœ… æ¸¸æˆæ•°æ®å·²é‡ç½®ï¼');
            }
        };
        
        window.checkUnityDashboard = function() {
            window.open('https://dashboard.unity3d.com/', '_blank');
        };
        
        // ========== é¡µé¢åŠ è½½ ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é«˜çº§ç»•è¿‡ç‰ˆæ¸¸æˆåŠ è½½å®Œæˆ');
            console.log('ğŸ‘¤ å¼€å‘è€…: youmeng00000');
            console.log('ğŸŒ éƒ¨ç½²å¹³å°: Vercel');
            console.log('ğŸ¯ æ¨¡å¼: ' + (CONFIG.testMode ? 'æµ‹è¯•æ¨¡å¼' : 'çœŸå®æ”¶ç›Šæ¨¡å¼'));
            
            // åŠ è½½æ•°æ®
            loadGameData();
            
            // è‡ªåŠ¨ä¿å­˜
            setInterval(saveGameData, 30000);
            
            console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        });
        
        // è‡ªåŠ¨ä¿å­˜
        window.addEventListener('beforeunload', saveGameData);
    </script>
</body>
</html>
