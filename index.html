<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¹¿å‘Šæ”¶ç›Šæ¸¸æˆ - ç§»åŠ¨ç´§å‡‘ç‰ˆ</title>
    
    <!-- ç§»åŠ¨ç«¯ä¼˜åŒ–meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#1a1a2e">
    
    <style>
        /* é‡ç½®å’ŒåŸºç¡€ */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            font-size: 14px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
        }
        
        /* ç´§å‡‘å¸ƒå±€å®¹å™¨ */
        .compact-container {
            width: 100%;
            height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* ç´§å‡‘å¤´éƒ¨ */
        .compact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 5px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .game-title {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .mode-badge {
            background: linear-gradient(135deg, #FF9800, #FF5722);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }
        
        /* ç´§å‡‘æ§åˆ¶æŒ‰é’®è¡Œ */
        .compact-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .control-btn {
            background: rgba(33, 150, 243, 0.8);
            color: white;
            border: none;
            padding: 8px 4px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            min-height: 36px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            transition: all 0.2s;
        }
        
        .control-btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        .control-btn.test { background: rgba(255, 152, 0, 0.8); }
        .control-btn.reset { background: rgba(244, 67, 54, 0.8); }
        .control-btn.real { background: rgba(76, 175, 80, 0.8); }
        .control-btn.help { background: rgba(156, 39, 176, 0.8); }
        .control-btn.theme { background: rgba(0, 150, 136, 0.8); }
        .control-btn.export { background: rgba(255, 87, 34, 0.8); }
        
        /* ç´§å‡‘å¹¿å‘Šä½ */
        .compact-ad-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 8px;
            flex: 1;
            min-height: 0; /* é‡è¦ï¼šé˜²æ­¢æº¢å‡º */
        }
        
        .ad-slot {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 140px;
            max-height: 160px;
        }
        
        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .slot-number {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .slot-title {
            font-size: 13px;
            font-weight: bold;
        }
        
        .slot-status {
            flex: 1;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 8px;
            margin: 5px 0;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 40px;
            overflow: hidden;
            word-break: break-word;
        }
        
        .slot-earnings {
            font-size: 11px;
            color: #aaa;
            text-align: center;
            margin: 3px 0;
        }
        
        .earnings-amount {
            color: #4CAF50;
            font-weight: bold;
            font-size: 14px;
        }
        
        .slot-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 8px 0;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 5px;
            min-height: 32px;
        }
        
        .slot-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        /* ç´§å‡‘ç»Ÿè®¡é¢æ¿ */
        .compact-stats {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .stats-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .stat-item {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            border-left: 3px solid #4CAF50;
        }
        
        .stat-label {
            font-size: 10px;
            color: #aaa;
            margin-bottom: 3px;
        }
        
        .stat-value {
            font-size: 14px;
            font-weight: bold;
        }
        
        /* ç´§å‡‘è®°å½•åŒºåŸŸ */
        .compact-records {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 8px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            max-height: 180px;
        }
        
        .records-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 11px;
        }
        
        /* æç®€æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(76, 175, 80, 0.5);
            border-radius: 2px;
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) {
            .compact-container {
                padding: 5px;
            }
            
            .compact-ad-slots {
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }
            
            .ad-slot {
                min-height: 130px;
                max-height: 140px;
                padding: 8px;
            }
            
            .compact-stats {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                max-height: 120px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .compact-records {
                max-height: 120px;
            }
        }
        
        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 320px) {
            .compact-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .compact-ad-slots {
                gap: 5px;
            }
            
            .ad-slot {
                padding: 6px;
                min-height: 130px;
            }
            
            .slot-status {
                font-size: 10px;
                padding: 6px;
                min-height: 35px;
            }
            
            .slot-btn {
                font-size: 11px;
                padding: 6px 0;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        /* é˜²æ­¢IOSæ©¡çš®ç­‹æ•ˆæœ */
        .no-bounce {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="no-bounce">
    <div class="compact-container fade-in">
        <!-- å¤´éƒ¨ -->
        <div class="compact-header">
            <div class="game-title">ğŸ’° æ”¶ç›Šæ¸¸æˆ</div>
            <div class="mode-badge" id="mode-badge">ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼</div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="compact-controls">
            <button class="control-btn test" onclick="testUnity()">
                <span>ğŸ”—</span>
                <span>è¿æ¥æµ‹è¯•</span>
            </button>
            <button class="control-btn reset" onclick="resetGame()">
                <span>ğŸ”„</span>
                <span>é‡ç½®</span>
            </button>
            <button class="control-btn real" onclick="tryRealMode()">
                <span>ğŸ’°</span>
                <span>çœŸå®æ¨¡å¼</span>
            </button>
            <button class="control-btn help" onclick="showHelp()">
                <span>â“</span>
                <span>å¸®åŠ©</span>
            </button>
            <button class="control-btn theme" onclick="toggleTheme()">
                <span>ğŸ¨</span>
                <span>ä¸»é¢˜</span>
            </button>
            <button class="control-btn export" onclick="exportData()">
                <span>ğŸ’¾</span>
                <span>å¯¼å‡º</span>
            </button>
        </div>
        
        <!-- ä¸‰ä¸ªå¹¿å‘Šä½ -->
        <div class="compact-ad-slots">
            <!-- å¹¿å‘Šä½1 -->
            <div class="ad-slot">
                <div class="slot-header">
                    <div class="slot-number">1</div>
                    <div class="slot-title">å¹¿å‘Šä½1</div>
                </div>
                <div class="slot-status" id="status1">âœ… å‡†å¤‡å°±ç»ª</div>
                <div class="slot-earnings">
                    æ”¶ç›Š: <span class="earnings-amount" id="earnings1">$0.00</span>
                </div>
                <button class="slot-btn" onclick="showAd(1)" id="btn1">
                    ğŸ¬ è§‚çœ‹å¹¿å‘Š
                </button>
            </div>
            
            <!-- å¹¿å‘Šä½2 -->
            <div class="ad-slot">
                <div class="slot-header">
                    <div class="slot-number">2</div>
                    <div class="slot-title">å¹¿å‘Šä½2</div>
                </div>
                <div class="slot-status" id="status2">âœ… å‡†å¤‡å°±ç»ª</div>
                <div class="slot-earnings">
                    æ”¶ç›Š: <span class="earnings-amount" id="earnings2">$0.00</span>
                </div>
                <button class="slot-btn" onclick="showAd(2)" id="btn2">
                    ğŸ¬ è§‚çœ‹å¹¿å‘Š
                </button>
            </div>
            
            <!-- å¹¿å‘Šä½3 -->
            <div class="ad-slot">
                <div class="slot-header">
                    <div class="slot-number">3</div>
                    <div class="slot-title">å¹¿å‘Šä½3</div>
                </div>
                <div class="slot-status" id="status3">âœ… å‡†å¤‡å°±ç»ª</div>
                <div class="slot-earnings">
                    æ”¶ç›Š: <span class="earnings-amount" id="earnings3">$0.00</span>
                </div>
                <button class="slot-btn" onclick="showAd(3)" id="btn3">
                    ğŸ¬ è§‚çœ‹å¹¿å‘Š
                </button>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="compact-stats">
            <div class="stats-title">
                <span>ğŸ“Š æ”¶ç›Šç»Ÿè®¡</span>
                <span style="font-size:11px;color:#aaa;" id="recordCount">0æ¡è®°å½•</span>
            </div>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">ä»Šæ—¥æ”¶ç›Š</div>
                    <div class="stat-value" id="todayEarnings">$0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ç´¯è®¡æ”¶ç›Š</div>
                    <div class="stat-value" id="totalEarnings">$0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å¹¿å‘Šå±•ç¤º</div>
                    <div class="stat-value" id="impressions">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ç‚¹å‡»ç‡</div>
                    <div class="stat-value" id="clickRate">0%</div>
                </div>
            </div>
        </div>
        
        <!-- æ”¶ç›Šè®°å½• -->
        <div class="compact-records">
            <div class="records-title">
                <span>ğŸ“… ä»Šæ—¥è®°å½•</span>
                <span style="font-size:10px;color:#4CAF50;" id="todayDate"></span>
            </div>
            <div id="recordsList">
                <div style="text-align:center;padding:10px;color:#666;font-size:12px;">
                    æš‚æ— æ”¶ç›Šè®°å½•
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== è®¾å¤‡æ£€æµ‹ ==========
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        // ========== æ¸¸æˆé…ç½® ==========
        const CONFIG = {
            mode: 'simulation', // simulation | real
            adCooldown: 30,
            baseEarnings: 0.35,
            gameId: '6028834',
            adUnits: ['youmeng1', 'youmeng2', 'youmeng3']
        };
        
        // ========== æ¸¸æˆæ•°æ® ==========
        let gameData = {
            impressions: 0,
            clicks: 0,
            todayEarnings: 0,
            totalEarnings: 0,
            adCooldowns: [0, 0, 0],
            adEarnings: [0, 0, 0],
            dailyRecords: [],
            todayDate: new Date().toLocaleDateString('zh-CN')
        };
        
        // ========== ç´§å‡‘å¹¿å‘Šç³»ç»Ÿ ==========
        class CompactAdSystem {
            constructor() {
                console.log('ğŸ“± ç´§å‡‘ç‰ˆå¹¿å‘Šç³»ç»Ÿå¯åŠ¨');
                this.updateModeDisplay();
                this.init();
            }
            
            init() {
                // ç§»åŠ¨ç«¯ä¼˜åŒ–
                if (isMobile) {
                    this.optimizeForMobile();
                }
                
                // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
                document.getElementById('todayDate').textContent = gameData.todayDate;
            }
            
            optimizeForMobile() {
                console.log('ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–...');
                
                // é˜²æ­¢åŒå‡»ç¼©æ”¾
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                // ä¼˜åŒ–æŒ‰é’®è§¦æ‘¸
                document.querySelectorAll('button').forEach(btn => {
                    btn.style.minHeight = '36px';
                    btn.addEventListener('touchstart', () => {
                        btn.style.opacity = '0.8';
                    });
                    btn.addEventListener('touchend', () => {
                        btn.style.opacity = '1';
                    });
                });
            }
            
            updateModeDisplay() {
                const badge = document.getElementById('mode-badge');
                if (badge) {
                    if (CONFIG.mode === 'real') {
                        badge.textContent = 'ğŸ’° çœŸå®æ”¶ç›Š';
                        badge.style.background = 'linear-gradient(135deg, #4CAF50, #2E7D32)';
                    } else {
                        badge.textContent = 'ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼';
                        badge.style.background = 'linear-gradient(135deg, #FF9800, #FF5722)';
                    }
                }
            }
            
            async showAd(adSlotId) {
                if (CONFIG.mode === 'real' && typeof unityads !== 'undefined') {
                    return this.showRealAd(adSlotId);
                } else {
                    return this.showSimulationAd(adSlotId);
                }
            }
            
            async showRealAd(adSlotId) {
                console.log(`ğŸ¬ çœŸå®å¹¿å‘Š ${adSlotId}`);
                
                const adUnitId = CONFIG.adUnits[adSlotId - 1];
                
                return new Promise((resolve) => {
                    unityads.show(adUnitId, {
                        onClosed: (result) => {
                            if (result && result.completed) {
                                this.recordAdComplete(adSlotId, true);
                                resolve({ success: true, isRealAd: true });
                            } else {
                                resolve({ success: false, message: 'å¹¿å‘Šæœªå®Œæˆ' });
                            }
                        },
                        onFailed: (error) => {
                            console.error('çœŸå®å¹¿å‘Šå¤±è´¥:', error);
                            this.showSimulationAd(adSlotId).then(resolve);
                        }
                    });
                });
            }
            
            async showSimulationAd(adSlotId) {
                return new Promise((resolve) => {
                    this.showCompactAdInterface(adSlotId, resolve);
                });
            }
            
            showCompactAdInterface(adSlotId, resolve) {
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0; left: 0;
                    width: 100%; height: 100%;
                    background: rgba(0,0,0,0.98);
                    z-index: 9999;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    padding: 15px;
                `;
                
                const earnings = CONFIG.baseEarnings * (0.8 + Math.random() * 0.4);
                const adColors = ['#4CAF50', '#2196F3', '#9C27B0'];
                const adColor = adColors[adSlotId - 1];
                
                overlay.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: white; border-radius: 15px; padding: 20px; width: 100%; max-width: 350px; text-align: center; border: 2px solid ${adColor};">
                        <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“±</div>
                        <h3 style="color: ${adColor}; margin-bottom: 10px;">å¹¿å‘Šæ¼”ç¤º ${adSlotId}</h3>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px;">
                                <div>
                                    <div style="opacity: 0.7;">æ”¶ç›Š</div>
                                    <div style="color: #4CAF50; font-weight: bold; font-size: 18px;">$${earnings.toFixed(2)}</div>
                                </div>
                                <div>
                                    <div style="opacity: 0.7;">æ—¶é—´</div>
                                    <div style="font-weight: bold;" id="ad-timer">30ç§’</div>
                                </div>
                            </div>
                            
                            <div style="width: 100%; background: rgba(255,255,255,0.1); height: 5px; border-radius: 3px;">
                                <div id="ad-progress" style="width: 0%; height: 100%; background: ${adColor}; border-radius: 3px; transition: width 1s linear;"></div>
                            </div>
                        </div>
                        
                        <button id="ad-complete" style="background: ${adColor}; color: white; border: none; padding: 12px 0; border-radius: 20px; font-size: 16px; font-weight: bold; width: 100%; margin-top: 10px;">
                            å®Œæˆ (+$${earnings.toFixed(2)})
                        </button>
                        
                        ${CONFIG.mode === 'simulation' ? `
                        <div style="margin-top: 15px; font-size: 11px; opacity: 0.6; padding: 8px; background: rgba(255,152,0,0.1); border-radius: 8px;">
                            ğŸ’¡ ä½¿ç”¨VPNå¯åˆ‡æ¢åˆ°çœŸå®æ”¶ç›Šæ¨¡å¼
                        </div>
                        ` : ''}
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                let timeLeft = 30;
                const timerEl = document.getElementById('ad-timer');
                const progressEl = document.getElementById('ad-progress');
                let timerInterval;
                
                function updateTimer() {
                    timeLeft--;
                    timerEl.textContent = `${timeLeft}ç§’`;
                    const progress = ((30 - timeLeft) / 30) * 100;
                    progressEl.style.width = `${progress}%`;
                    
                    if (timeLeft <= 0) {
                        completeAd();
                    }
                }
                
                timerInterval = setInterval(updateTimer, 1000);
                
                function completeAd() {
                    clearInterval(timerInterval);
                    document.body.removeChild(overlay);
                    
                    adSystem.recordAdComplete(adSlotId, false, earnings);
                    resolve({ success: true, isRealAd: false });
                }
                
                const completeBtn = document.getElementById('ad-complete');
                completeBtn.onclick = completeAd;
                
                // ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–
                if (isMobile) {
                    completeBtn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        completeBtn.style.opacity = '0.8';
                    });
                    
                    completeBtn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        completeBtn.style.opacity = '1';
                    });
                }
            }
            
            recordAdComplete(adSlotId, isRealAd, earnings = CONFIG.baseEarnings) {
                const adId = adSlotId - 1;
                
                gameData.impressions++;
                gameData.clicks++;
                gameData.todayEarnings += earnings;
                gameData.totalEarnings += earnings;
                gameData.adEarnings[adId] += earnings;
                gameData.adCooldowns[adId] = CONFIG.adCooldown;
                
                this.addDailyRecord(adSlotId, earnings, isRealAd ? 'çœŸå®' : 'æ¨¡æ‹Ÿ');
                
                updateStats();
                updateCooldownDisplay();
                updateDailyRecords();
                
                this.updateAdStatus(adSlotId, isRealAd);
            }
            
            addDailyRecord(adSlotId, earnings, type) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
                
                const record = {
                    time: timeStr,
                    adSlot: adSlotId,
                    earnings: earnings.toFixed(2),
                    type: type
                };
                
                gameData.dailyRecords.unshift(record);
                
                if (gameData.dailyRecords.length > 10) {
                    gameData.dailyRecords = gameData.dailyRecords.slice(0, 10);
                }
            }
            
            updateAdStatus(adSlotId, isRealAd) {
                const statusEl = document.getElementById(`status${adSlotId}`);
                const earningsEl = document.getElementById(`earnings${adSlotId}`);
                
                if (statusEl) {
                    statusEl.textContent = isRealAd ? 'âœ… çœŸå®å®Œæˆ' : 'âœ… æ¨¡æ‹Ÿå®Œæˆ';
                }
                
                if (earningsEl) {
                    earningsEl.textContent = '$' + gameData.adEarnings[adSlotId - 1].toFixed(2);
                    earningsEl.classList.add('pulse');
                    setTimeout(() => earningsEl.classList.remove('pulse'), 500);
                }
            }
        }
        
        // ========== åˆå§‹åŒ– ==========
        const adSystem = new CompactAdSystem();
        
        // å†·å´è®¡æ—¶å™¨
        setInterval(() => {
            gameData.adCooldowns = gameData.adCooldowns.map(cd => 
                cd > 0 ? cd - 1 : 0
            );
            updateCooldownDisplay();
        }, 1000);
        
        // æ˜¾ç¤ºå¹¿å‘Š
        async function showAd(adIndex) {
            const adId = adIndex - 1;
            
            if (gameData.adCooldowns[adId] > 0) {
                alert(`å†·å´ä¸­ï¼Œè¯·ç­‰å¾… ${gameData.adCooldowns[adId]} ç§’`);
                return;
            }
            
            const btn = document.getElementById(`btn${adIndex}`);
            const statusEl = document.getElementById(`status${adIndex}`);
            
            btn.disabled = true;
            btn.innerHTML = 'â³ åŠ è½½ä¸­...';
            statusEl.innerHTML = 'â³ å‡†å¤‡å¹¿å‘Š...';
            
            try {
                const result = await adSystem.showAd(adIndex);
                
                if (result.success) {
                    if (result.isRealAd) {
                        statusEl.innerHTML = 'âœ… çœŸå®å®Œæˆ';
                    } else {
                        statusEl.innerHTML = 'âœ… æ¨¡æ‹Ÿå®Œæˆ';
                    }
                } else {
                    statusEl.innerHTML = `âš ï¸ ${result.message}`;
                }
            } catch (error) {
                console.error('å¹¿å‘Šé”™è¯¯:', error);
                statusEl.innerHTML = 'âŒ å¹¿å‘Šå¤±è´¥';
            }
            
            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
            }, 1000);
        }
        
        // æ›´æ–°å†·å´æ˜¾ç¤º
        function updateCooldownDisplay() {
            for (let i = 0; i < 3; i++) {
                const statusEl = document.getElementById(`status${i + 1}`);
                const btn = document.getElementById(`btn${i + 1}`);
                
                const cd = gameData.adCooldowns[i];
                if (cd > 0) {
                    statusEl.innerHTML = `â³ ${cd}ç§’`;
                    btn.disabled = true;
                    btn.innerHTML = `å†·å´ä¸­`;
                } else {
                    statusEl.innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    btn.disabled = false;
                    btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
                }
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('impressions').textContent = gameData.impressions;
            document.getElementById('todayEarnings').textContent = '$' + gameData.todayEarnings.toFixed(2);
            document.getElementById('totalEarnings').textContent = '$' + gameData.totalEarnings.toFixed(2);
            
            const clickRate = gameData.impressions > 0 ? 
                ((gameData.clicks / gameData.impressions) * 100).toFixed(1) : 0;
            document.getElementById('clickRate').textContent = clickRate + '%';
            
            for (let i = 0; i < 3; i++) {
                const el = document.getElementById(`earnings${i + 1}`);
                if (el) el.textContent = '$' + gameData.adEarnings[i].toFixed(2);
            }
            
            // æ›´æ–°è®°å½•æ•°é‡
            document.getElementById('recordCount').textContent = `${gameData.dailyRecords.length}æ¡è®°å½•`;
            
            saveGameData();
        }
        
        // æ›´æ–°æ—¥æ”¶ç›Šè®°å½•
        function updateDailyRecords() {
            const container = document.getElementById('recordsList');
            if (!container) return;
            
            if (gameData.dailyRecords.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center;padding:10px;color:#666;font-size:12px;">
                        æš‚æ— æ”¶ç›Šè®°å½•
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            gameData.dailyRecords.forEach(record => {
                const item = document.createElement('div');
                item.className = 'record-item';
                item.innerHTML = `
                    <span>${record.time}</span>
                    <span>å¹¿å‘Šä½${record.adSlot}</span>
                    <span style="color: ${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'}; font-weight: bold;">
                        $${record.earnings}
                    </span>
                `;
                container.appendChild(item);
            });
        }
        
        // ä¿å­˜æ•°æ®
        function saveGameData() {
            try {
                localStorage.setItem('compactGameData', JSON.stringify(gameData));
            } catch (error) {
                console.log('ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ•°æ®
        function loadGameData() {
            try {
                const saved = localStorage.getItem('compactGameData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    const today = new Date().toLocaleDateString('zh-CN');
                    
                    if (parsed.todayDate !== today) {
                        parsed.todayEarnings = 0;
                        parsed.todayDate = today;
                        parsed.adCooldowns = [0, 0, 0];
                        parsed.dailyRecords = [];
                    }
                    
                    gameData = {
                        ...gameData,
                        ...parsed,
                        adCooldowns: parsed.adCooldowns || [0, 0, 0],
                        adEarnings: parsed.adEarnings || [0, 0, 0],
                        dailyRecords: parsed.dailyRecords || []
                    };
                    
                    updateStats();
                    updateDailyRecords();
                    updateCooldownDisplay();
                }
            } catch (error) {
                console.log('åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // ========== æ§åˆ¶åŠŸèƒ½ ==========
        window.testUnity = async function() {
            const canAccess = await testNetwork();
            
            if (canAccess) {
                alert('âœ… ç½‘ç»œè¿æ¥æ­£å¸¸\nå¯ä»¥å°è¯•åˆ‡æ¢åˆ°çœŸå®æ¨¡å¼');
            } else {
                alert('âŒ ç½‘ç»œè¿æ¥å¤±è´¥\nè¯·æ£€æŸ¥VPNè¿æ¥');
            }
        };
        
        async function testNetwork() {
            try {
                await fetch('https://cdn.unityads.unity3d.com/', { 
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                return true;
            } catch (error) {
                return false;
            }
        }
        
        window.resetGame = function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ¸¸æˆæ•°æ®å—ï¼Ÿ')) {
                gameData = {
                    impressions: 0,
                    clicks: 0,
                    todayEarnings: 0,
                    totalEarnings: 0,
                    adCooldowns: [0, 0, 0],
                    adEarnings: [0, 0, 0],
                    dailyRecords: [],
                    todayDate: new Date().toLocaleDateString('zh-CN')
                };
                
                updateStats();
                updateDailyRecords();
                updateCooldownDisplay();
                
                alert('âœ… æ¸¸æˆæ•°æ®å·²é‡ç½®ï¼');
            }
        };
        
        window.tryRealMode = async function() {
            if (CONFIG.mode === 'real') {
                alert('ğŸ’° å·²ç»æ˜¯çœŸå®æ”¶ç›Šæ¨¡å¼');
                return;
            }
            
            const useVPN = confirm('åˆ‡æ¢åˆ°çœŸå®æ”¶ç›Šæ¨¡å¼ï¼Ÿ\n\néœ€è¦ï¼š\nâœ… æµ·å¤–ç½‘ç»œæˆ–VPNè¿æ¥\n\nç¡®å®šè¦åˆ‡æ¢å—ï¼Ÿ');
            
            if (!useVPN) return;
            
            // æµ‹è¯•ç½‘ç»œ
            const networkOk = await testNetwork();
            
            if (!networkOk) {
                alert('âŒ ç½‘ç»œæµ‹è¯•å¤±è´¥\nè¯·ç¡®è®¤VPNå·²è¿æ¥å¹¶åˆ·æ–°é¡µé¢');
                return;
            }
            
            // åŠ è½½Unity SDK
            const script = document.createElement('script');
            script.src = 'https://cdn.unityads.unity3d.com/unity-ads-sdk.js';
            script.crossOrigin = 'anonymous';
            
            script.onload = function() {
                if (typeof unityads !== 'undefined') {
                    unityads.init(CONFIG.gameId, {
                        testMode: false,
                        onInitialized: function() {
                            CONFIG.mode = 'real';
                            adSystem.updateModeDisplay();
                            alert('ğŸ‰ æˆåŠŸåˆ‡æ¢åˆ°çœŸå®æ”¶ç›Šæ¨¡å¼ï¼\nğŸ’° ç°åœ¨å¼€å§‹äº§ç”ŸçœŸå®ç¾å…ƒæ”¶ç›Šï¼');
                        },
                        onFailed: function(error) {
                            alert('âŒ Unityåˆå§‹åŒ–å¤±è´¥\nè¯·ç¨åé‡è¯•');
                        }
                    });
                } else {
                    alert('âŒ Unity SDKåŠ è½½å¤±è´¥');
                }
            };
            
            script.onerror = function() {
                alert('âŒ æ— æ³•åŠ è½½Unity SDK\nè¯·æ£€æŸ¥VPNè¿æ¥');
            };
            
            document.head.appendChild(script);
        };
        
        window.showHelp = function() {
            const helpText = `
ğŸ“± ç´§å‡‘ç‰ˆä½¿ç”¨æŒ‡å—ï¼š

ğŸ® åŸºæœ¬æ“ä½œï¼š
1. ç‚¹å‡»"è§‚çœ‹å¹¿å‘Š"æŒ‰é’®
2. ç­‰å¾…30ç§’å¹¿å‘Šæ¼”ç¤º
3. è·å¾—æ¨¡æ‹Ÿæ”¶ç›Š

ğŸ’° æ”¶ç›Šæ¨¡å¼ï¼š
â€¢ æ¨¡æ‹Ÿæ¨¡å¼ï¼šæ‰€æœ‰ç”¨æˆ·å¯ç”¨
â€¢ çœŸå®æ¨¡å¼ï¼šéœ€è¦VPNè¿æ¥

âš¡ ä¼˜åŒ–ç‰¹æ€§ï¼š
â€¢ ç´§å‡‘å¸ƒå±€ï¼Œé€‚åˆæ‰‹æœº
â€¢ è§¦æ‘¸ä¼˜åŒ–ï¼ŒæŒ‰é’®æ˜“ç‚¹å‡»
â€¢ è‡ªåŠ¨ä¿å­˜æ•°æ®

ğŸŒ ç½‘ç»œè¯´æ˜ï¼š
â€¢ ä¸­å›½å¤§é™†è®¿é—®Unityå—é™
â€¢ æµ·å¤–/VPNç”¨æˆ·å¯ç”¨çœŸå®æ¨¡å¼

ğŸ’¡ å»ºè®®ï¼š
å…ˆç”¨æ¨¡æ‹Ÿæ¨¡å¼ä½“éªŒ
æœ‰æ¡ä»¶å†åˆ‡æ¢åˆ°çœŸå®æ¨¡å¼
            `;
            
            alert(helpText);
        };
        
        window.toggleTheme = function() {
            const isDark = document.body.style.background.includes('#1a1a2e');
            
            if (isDark) {
                // åˆ‡æ¢åˆ°æµ…è‰²ä¸»é¢˜
                document.body.style.background = 'linear-gradient(135deg, #f5f7fa, #c3cfe2)';
                document.body.style.color = '#333';
            } else {
                // åˆ‡æ¢å›æ·±è‰²ä¸»é¢˜
                document.body.style.background = 'linear-gradient(135deg, #1a1a2e, #16213e)';
                document.body.style.color = '#fff';
            }
        };
        
        window.exportData = function() {
            const dataStr = JSON.stringify(gameData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const fileName = `æ”¶ç›Šæ•°æ®_${gameData.todayDate.replace(/\//g, '-')}.json`;
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', fileName);
            link.click();
            
            alert('âœ… æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
        };
        
        // ä¸€é”®æµ‹è¯•æ‰€æœ‰å¹¿å‘Š
        window.testAllAds = function() {
            for (let i = 1; i <= 3; i++) {
                if (gameData.adCooldowns[i - 1] === 0) {
                    setTimeout(() => {
                        const btn = document.getElementById(`btn${i}`);
                        if (btn && !btn.disabled) {
                            showAd(i);
                        }
                    }, i * 800);
                }
            }
        };
        
        // æ·»åŠ å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetGame();
            }
        });
        
        // ========== é¡µé¢åŠ è½½ ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“± ç´§å‡‘ç‰ˆæ¸¸æˆåŠ è½½å®Œæˆ');
            
            // åŠ è½½æ•°æ®
            loadGameData();
            
            // è‡ªåŠ¨ä¿å­˜
            setInterval(saveGameData, 30000);
            
            // ç§»åŠ¨ç«¯ä¼˜åŒ–
            if (isMobile) {
                // é˜²æ­¢ä¸‹æ‹‰åˆ·æ–°
                document.addEventListener('touchmove', (e) => {
                    if (window.scrollY === 0) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
            
            console.log('âœ… æ¸¸æˆå°±ç»ªï¼');
        });
        
        // è‡ªåŠ¨ä¿å­˜
        window.addEventListener('beforeunload', saveGameData);
    </script>
</body>
</html>
