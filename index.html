<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šæ”¶ç›Šæ¸¸æˆ - çœŸå®æ”¶ç›Šä¸“ä¸šç‰ˆ</title>
    
    <!-- Unity Ads SDK (å¿…é¡») -->
    <script src="https://cdn.unityads.unity3d.com/unity-ads-sdk.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            padding: 20px;
            min-height: 100vh;
            color: #fff;
        }
        
        /* ä¸‰åˆ—å¸ƒå±€ - 3cmå®½ Ã— 5cmé«˜ */
        .three-columns {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .ad-column {
            width: 3cm;          /* 3å˜ç±³å®½ */
            min-height: 5cm;     /* 5å˜ç±³é«˜ */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .ad-column:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            border-color: rgba(76, 175, 80, 0.5);
        }
        
        .column-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.5);
        }
        
        .column-content {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
        }
        
        .ad-title {
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .ad-status-column {
            width: 100%;
            min-height: 50px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-break: break-word;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .ad-status-column.ready {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.5);
        }
        
        .ad-status-column.cooldown {
            background: rgba(255, 152, 0, 0.2);
            border-color: rgba(255, 152, 0, 0.5);
        }
        
        .earnings-display-column {
            font-size: 11px;
            color: #ccc;
            margin: 6px 0;
            text-align: center;
        }
        
        .earnings-amount-column {
            color: #4CAF50;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
        }
        
        .ad-btn-column {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 10px 0;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
            transition: all 0.3s;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .ad-btn-column:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
        }
        
        .ad-btn-column:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* æ”¶ç›Šç»Ÿè®¡é¢æ¿ */
        .stats-panel-column {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stats-header-column {
            text-align: center;
            color: #fff;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats-grid-column {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-item-column {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid #4CAF50;
            transition: all 0.3s;
        }
        
        .stat-item-column:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .stat-label-column {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value-column {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* æ—¥æ”¶ç›Šè¯¦ç»†é¢æ¿ */
        .daily-panel-column {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .daily-header-column {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .daily-title-column {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .daily-date-column {
            font-size: 12px;
            color: #aaa;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .daily-table-container {
            overflow-x: auto;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .daily-table-column {
            width: 100%;
            font-size: 12px;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        .daily-table-column thead {
            background: rgba(0, 0, 0, 0.4);
        }
        
        .daily-table-column th {
            padding: 12px;
            text-align: center;
            font-weight: bold;
            color: #fff;
            border-bottom: 2px solid rgba(76, 175, 80, 0.5);
        }
        
        .daily-table-column td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #ddd;
        }
        
        .daily-table-column tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel-column {
            position: fixed;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 180px;
        }
        
        .control-title-column {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        
        .control-btn-column {
            background: rgba(33, 150, 243, 0.8);
            color: white;
            border: none;
            padding: 8px 6px;
            border-radius: 6px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .control-btn-column:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }
        
        .control-btn-column.test {
            background: rgba(255, 152, 0, 0.8);
        }
        
        .control-btn-column.reset {
            background: rgba(244, 67, 54, 0.8);
        }
        
        .control-btn-column.dashboard {
            background: rgba(156, 39, 176, 0.8);
        }
        
        .control-btn-column.export {
            background: rgba(76, 175, 80, 0.8);
        }
        
        /* æ¨¡å¼æŒ‡ç¤ºå™¨ */
        .mode-indicator-column {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .three-columns {
                flex-direction: column;
                align-items: center;
            }
            
            .ad-column {
                width: 90%;
                min-height: auto;
                margin-bottom: 15px;
            }
            
            .stats-grid-column {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-panel-column {
                position: relative;
                top: auto;
                left: auto;
                margin: 0 auto 20px;
                max-width: 400px;
            }
            
            .mode-indicator-column {
                position: relative;
                top: auto;
                right: auto;
                margin: 0 auto 20px;
                width: fit-content;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes coinBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .coin-animation {
            animation: coinBounce 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); }
            50% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.8); }
        }
        
        .glow {
            animation: glow 2s infinite;
        }
    </style>
</head>
<body>
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel-column fade-in">
        <div class="control-title-column">ğŸ® æ§åˆ¶ä¸­å¿ƒ</div>
        <div class="control-grid">
            <button class="control-btn-column test" onclick="testUnityConnection()">
                <span>ğŸ”—</span> æµ‹è¯•
            </button>
            <button class="control-btn-column" onclick="showAllAds()">
                <span>ğŸš€</span> ä¸€é”®
            </button>
            <button class="control-btn-column reset" onclick="resetGame()">
                <span>ğŸ”„</span> é‡ç½®
            </button>
            <button class="control-btn-column dashboard" onclick="checkUnityDashboard()">
                <span>ğŸ“Š</span> åå°
            </button>
            <button class="control-btn-column export" onclick="exportData()">
                <span>ğŸ’¾</span> å¯¼å‡º
            </button>
            <div style="grid-column: span 2; font-size: 9px; color: #888; text-align: center; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 4px;">
                æ¨¡å¼: <span id="mode-text" style="color: #4CAF50; font-weight: bold;">æ£€æµ‹ä¸­...</span>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡å¼æŒ‡ç¤ºå™¨ -->
    <div class="mode-indicator-column fade-in" id="mode-indicator">
        <span id="mode-icon">ğŸ®</span>
        <span id="mode-label">æ£€æµ‹ä¸­</span>
    </div>
    
    <!-- ä¸‰åˆ—å¹¿å‘Šçª—å£ (3cm Ã— 5cm) -->
    <div class="three-columns fade-in">
        <div class="ad-column">
            <div class="column-number">1</div>
            <div class="column-content">
                <div class="ad-title">å¹¿å‘Šä½ 1</div>
                <div class="ad-status-column ready" id="status1">
                    ğŸ” åˆå§‹åŒ–...
                </div>
                <div class="earnings-display-column">
                    æ”¶ç›Š: <span class="earnings-amount-column" id="earnings1">$0.00</span>
                </div>
                <button class="ad-btn-column" onclick="showAd(1)" id="btn1">
                    ğŸ¬ è§‚çœ‹å¹¿å‘Š
                </button>
            </div>
        </div>
        
        <div class="ad-column">
            <div class="column-number">2</div>
            <div class="column-content">
                <div class="ad-title">å¹¿å‘Šä½ 2</div>
                <div class="ad-status-column ready" id="status2">
                    ğŸ” åˆå§‹åŒ–...
                </div>
                <div class="earnings-display-column">
                    æ”¶ç›Š: <span class="earnings-amount-column" id="earnings2">$0.00</span>
                </div>
                <button class="ad-btn-column" onclick="showAd(2)" id="btn2">
                    ğŸ¬ è§‚çœ‹å¹¿å‘Š
                </button>
            </div>
        </div>
        
        <div class="ad-column">
            <div class="column-number">3</div>
            <div class="column-content">
                <div class="ad-title">å¹¿å‘Šä½ 3</div>
                <div class="ad-status-column ready" id="status3">
                    ğŸ” åˆå§‹åŒ–...
                </div>
                <div class="earnings-display-column">
                    æ”¶ç›Š: <span class="earnings-amount-column" id="earnings3">$0.00</span>
                </div>
                <button class="ad-btn-column" onclick="showAd(3)" id="btn3">
                    ğŸ¬ è§‚çœ‹å¹¿å‘Š
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ”¶ç›Šç»Ÿè®¡é¢æ¿ -->
    <div class="stats-panel-column fade-in">
        <div class="stats-header-column">
            <span>ğŸ“Š</span>
            <span>æ”¶ç›Šç»Ÿè®¡é¢æ¿</span>
        </div>
        
        <div class="stats-grid-column">
            <div class="stat-item-column">
                <div class="stat-label-column">ä»Šæ—¥æ”¶ç›Š</div>
                <div class="stat-value-column" id="todayEarnings">$0.00</div>
            </div>
            <div class="stat-item-column">
                <div class="stat-label-column">ç´¯è®¡æ”¶ç›Š</div>
                <div class="stat-value-column" id="totalEarnings">$0.00</div>
            </div>
            <div class="stat-item-column">
                <div class="stat-label-column">å¹¿å‘Šå±•ç¤º</div>
                <div class="stat-value-column" id="impressions">0</div>
            </div>
            <div class="stat-item-column">
                <div class="stat-label-column">ç‚¹å‡»ç‡</div>
                <div class="stat-value-column" id="clickRate">0%</div>
            </div>
        </div>
        
        <!-- æ—¥æ”¶ç›Šè¯¦ç»†é¢æ¿ -->
        <div class="daily-panel-column">
            <div class="daily-header-column">
                <div class="daily-title-column">
                    <span>ğŸ“…</span>
                    <span>æ—¥æ”¶ç›Šè®°å½•</span>
                </div>
                <div class="daily-date-column" id="currentDate">ä»Šå¤©</div>
            </div>
            
            <div class="daily-table-container">
                <table class="daily-table-column">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>æ—¶é—´</th>
                            <th>å¹¿å‘Šä½</th>
                            <th>æ”¶ç›Š</th>
                            <th>ç±»å‹</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="dailyRecords">
                        <tr>
                            <td colspan="6" style="color:#aaa;text-align:center;padding:20px;">
                                æš‚æ— æ”¶ç›Šè®°å½•ï¼Œç‚¹å‡»å¹¿å‘Šå¼€å§‹èµšé’±ï¼
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ========== çœŸå®æ”¶ç›Šé…ç½® ==========
        const CONFIG = {
            // UnityçœŸå®é…ç½® - ä½ çš„Game IDå’Œå¹¿å‘Šå•å…ƒ
            unityGameId: '6028834',
            unityAdUnits: {
                rewarded1: 'youmeng1',  // å¿…é¡»å’ŒUnityåå°ä¸€è‡´
                rewarded2: 'youmeng2',
                rewarded3: 'youmeng3'
            },
            
            // ğŸš€ çœŸå®æ”¶ç›Šæ¨¡å¼ - å¿…é¡»æ˜¯falseï¼
            testMode: false,  // false = çœŸå®æ”¶ç›Šï¼Œtrue = æµ‹è¯•æ¨¡å¼
            
            // æ¸¸æˆè®¾ç½®
            adCooldown: 30,         // å†·å´æ—¶é—´(ç§’)
            baseEarnings: 0.35      // åŸºç¡€é¢„ä¼°æ”¶ç›Š(ç¾å…ƒ)
        };
        
        // ========== æ¸¸æˆæ•°æ® ==========
        let gameData = {
            // åŸºç¡€ç»Ÿè®¡
            impressions: 0,
            clicks: 0,
            todayEarnings: 0,
            totalEarnings: 0,
            realEarnings: 0,        // çœŸå®æ”¶ç›Šç´¯è®¡
            
            // å¹¿å‘Šä½æ•°æ®
            adCooldowns: [0, 0, 0],
            adEarnings: [0, 0, 0],
            adCounts: [0, 0, 0],
            
            // æ—¥æ”¶ç›Šè®°å½•
            dailyRecords: [],
            
            // UnityçŠ¶æ€
            unityAvailable: false,
            unityInitialized: false,
            
            // å…ƒæ•°æ®
            todayDate: new Date().toLocaleDateString('zh-CN'),
            startDate: new Date().toISOString().split('T')[0],
            
            // ç‰ˆæœ¬
            version: '2.0'
        };
        
        // ========== UnityçœŸå®å¹¿å‘Šç³»ç»Ÿ ==========
        class RealUnityAdSystem {
            constructor() {
                this.isRealMode = true; // å¼ºåˆ¶çœŸå®æ¨¡å¼
                this.initializeUnity();
            }
            
            initializeUnity() {
                console.log('ğŸ® UnityçœŸå®å¹¿å‘Šç³»ç»Ÿåˆå§‹åŒ–...');
                console.log('ğŸ’° Game ID:', CONFIG.unityGameId);
                console.log('ğŸ¯ å¹¿å‘Šå•å…ƒ:', Object.values(CONFIG.unityAdUnits));
                
                // æ›´æ–°çŠ¶æ€
                this.updateStatus('æ­£åœ¨åˆå§‹åŒ–Unity...');
                this.updateModeDisplay('ğŸ”§ åˆå§‹åŒ–', '#FF9800');
                
                // æ£€æŸ¥Unity SDK
                if (typeof unityads === 'undefined') {
                    console.error('âŒ Unity SDKæœªåŠ è½½ï¼');
                    this.showError('Unity SDKæœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢');
                    return;
                }
                
                // åˆå§‹åŒ–Unity Ads - å¿…é¡»æ˜¯çœŸå®æ¨¡å¼ï¼
                unityads.init(CONFIG.unityGameId, {
                    testMode: CONFIG.testMode, // ä½¿ç”¨é…ç½®ä¸­çš„testMode
                    onInitialized: () => {
                        console.log('ğŸ‰ UnityçœŸå®å¹¿å‘Šåˆå§‹åŒ–æˆåŠŸï¼');
                        console.log('ğŸ’° æµ‹è¯•æ¨¡å¼:', CONFIG.testMode ? 'æ˜¯(æµ‹è¯•æ¨¡å¼ï¼Œæ— æ”¶ç›Š)' : 'å¦(çœŸå®æ”¶ç›Šæ¨¡å¼)');
                        
                        gameData.unityAvailable = true;
                        gameData.unityInitialized = true;
                        
                        if (CONFIG.testMode) {
                            console.warn('âš ï¸ è­¦å‘Šï¼šå½“å‰å¤„äºæµ‹è¯•æ¨¡å¼ï¼Œä¸ä¼šäº§ç”ŸçœŸå®æ”¶ç›Šï¼');
                            this.updateModeDisplay('ğŸ§ª æµ‹è¯•æ¨¡å¼', '#FF9800');
                            this.showNotification('âš ï¸ å½“å‰ä¸ºæµ‹è¯•æ¨¡å¼ï¼Œä¸ä¼šäº§ç”ŸçœŸå®æ”¶ç›Šï¼', '#FF9800');
                        } else {
                            console.log('ğŸ’° ç°åœ¨å¼€å§‹äº§ç”ŸçœŸå®ç¾å…ƒæ”¶ç›Šï¼');
                            this.updateModeDisplay('ğŸ’° çœŸå®æ”¶ç›Š', '#4CAF50');
                            this.showNotification('ğŸ‰ UnityçœŸå®æ”¶ç›Šæ¨¡å¼å·²å¯ç”¨ï¼', '#4CAF50');
                        }
                        
                        this.updateStatus('âœ… å‡†å¤‡å°±ç»ª');
                        this.updateAdStatusAll('âœ… å‡†å¤‡å°±ç»ª');
                    },
                    onFailed: (error) => {
                        console.error('âŒ Unityåˆå§‹åŒ–å¤±è´¥:', error);
                        this.updateModeDisplay('âŒ è¿æ¥å¤±è´¥', '#f44336');
                        this.updateStatus('âŒ Unityè¿æ¥å¤±è´¥');
                        this.showError('Unityè¿æ¥å¤±è´¥: ' + error);
                    }
                });
            }
            
            async showAd(adSlotId) {
                if (!gameData.unityInitialized) {
                    this.showError('Unityæœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢');
                    return { success: false, message: 'Unityæœªåˆå§‹åŒ–' };
                }
                
                const adId = adSlotId - 1;
                
                if (gameData.adCooldowns[adId] > 0) {
                    return { success: false, message: `å†·å´ä¸­ï¼Œè¯·ç­‰å¾… ${gameData.adCooldowns[adId]} ç§’` };
                }
                
                console.log(`ğŸ¬ å±•ç¤ºçœŸå®Unityå¹¿å‘Š ${adSlotId}`);
                
                try {
                    const adUnitId = CONFIG.unityAdUnits[`rewarded${adSlotId}`];
                    
                    const result = await new Promise((resolve) => {
                        unityads.show(adUnitId, {
                            onClosed: (adResult) => {
                                if (adResult && adResult.completed) {
                                    console.log('âœ… ç”¨æˆ·å®Œæˆè§‚çœ‹çœŸå®å¹¿å‘Š');
                                    console.log('ğŸ’° æ”¶ç›Šå·²è®¡å…¥Unityåå°è´¦æˆ·');
                                    
                                    // è®°å½•å¹¿å‘Šå®Œæˆ
                                    this.recordAdComplete(adSlotId, true);
                                    
                                    resolve({
                                        success: true,
                                        isRealAd: true,
                                        earnings: CONFIG.baseEarnings,
                                        message: 'çœŸå®å¹¿å‘Šå®Œæˆï¼'
                                    });
                                } else {
                                    resolve({
                                        success: false,
                                        message: 'å¹¿å‘Šæœªå®Œæˆè§‚çœ‹'
                                    });
                                }
                            },
                            onFailed: (error) => {
                                console.error('âŒ å¹¿å‘Šå±•ç¤ºå¤±è´¥:', error);
                                resolve({
                                    success: false,
                                    message: 'å¹¿å‘ŠåŠ è½½å¤±è´¥: ' + error
                                });
                            }
                        });
                    });
                    
                    return result;
                    
                } catch (error) {
                    console.error('âŒ å¹¿å‘Šå¼‚å¸¸:', error);
                    return {
                        success: false,
                        message: 'å¹¿å‘Šç³»ç»Ÿå¼‚å¸¸: ' + error
                    };
                }
            }
            
            recordAdComplete(adSlotId, isRealAd) {
                const adId = adSlotId - 1;
                const earnings = CONFIG.baseEarnings;
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                gameData.impressions++;
                gameData.clicks++;
                gameData.todayEarnings += earnings;
                gameData.totalEarnings += earnings;
                gameData.adEarnings[adId] += earnings;
                gameData.adCounts[adId]++;
                gameData.adCooldowns[adId] = CONFIG.adCooldown;
                
                if (isRealAd) {
                    gameData.realEarnings += earnings;
                }
                
                // æ·»åŠ æ—¥è®°å½•
                this.addDailyRecord(adSlotId, earnings, isRealAd ? 'çœŸå®' : 'æ¨¡æ‹Ÿ');
                
                // æ›´æ–°UI
                updateStats();
                updateCooldownDisplay();
                updateDailyRecords();
                
                // æ’­æ”¾æ”¶ç›ŠåŠ¨ç”»
                this.playCoinAnimation(adSlotId);
                
                // æ›´æ–°çŠ¶æ€
                this.updateAdStatusForSlot(adSlotId, isRealAd ? 'çœŸå®å®Œæˆ' : 'æ¨¡æ‹Ÿå®Œæˆ');
                
                // æ˜¾ç¤ºé€šçŸ¥
                if (isRealAd) {
                    this.showNotification(`ğŸ‰ å¹¿å‘Šä½ ${adSlotId} å®Œæˆï¼æ”¶ç›Šå·²è®¡å…¥Unityåå°`, '#4CAF50');
                }
            }
            
            addDailyRecord(adSlotId, earnings, type) {
                const date = new Date();
                const dateStr = date.toLocaleDateString('zh-CN');
                const timeStr = date.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false 
                });
                
                // æŸ¥æ‰¾ä»Šå¤©çš„è®°å½•ç»„
                let dateGroup = gameData.dailyRecords.find(group => group.date === dateStr);
                
                if (!dateGroup) {
                    dateGroup = {
                        date: dateStr,
                        totalEarnings: 0,
                        records: []
                    };
                    gameData.dailyRecords.unshift(dateGroup); // æœ€æ–°æ—¥æœŸåœ¨å‰é¢
                }
                
                // æ›´æ–°æ—¥æ€»æ”¶ç›Š
                dateGroup.totalEarnings += earnings;
                
                // æ·»åŠ è¯¦ç»†è®°å½•
                dateGroup.records.unshift({
                    time: timeStr,
                    adSlot: adSlotId,
                    earnings: earnings.toFixed(2),
                    type: type,
                    status: 'å®Œæˆ'
                });
                
                // é™åˆ¶è®°å½•æ•°é‡
                if (dateGroup.records.length > 20) {
                    dateGroup.records = dateGroup.records.slice(0, 20);
                }
                
                if (gameData.dailyRecords.length > 7) {
                    gameData.dailyRecords = gameData.dailyRecords.slice(0, 7);
                }
            }
            
            updateAdStatusForSlot(adSlotId, message) {
                const statusEl = document.getElementById(`status${adSlotId}`);
                const earningsEl = document.getElementById(`earnings${adSlotId}`);
                
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = 'ad-status-column ready';
                }
                
                if (earningsEl) {
                    earningsEl.textContent = '$' + gameData.adEarnings[adSlotId - 1].toFixed(2);
                    earningsEl.classList.add('coin-animation');
                    setTimeout(() => earningsEl.classList.remove('coin-animation'), 300);
                }
            }
            
            updateAdStatusAll(message) {
                for (let i = 1; i <= 3; i++) {
                    const statusEl = document.getElementById(`status${i}`);
                    if (statusEl && statusEl.textContent.includes('åˆå§‹åŒ–')) {
                        statusEl.textContent = message;
                        statusEl.className = 'ad-status-column ready';
                    }
                }
            }
            
            updateStatus(message) {
                console.log('ğŸ“± çŠ¶æ€æ›´æ–°:', message);
            }
            
            updateModeDisplay(label, color) {
                const iconMap = {
                    '#4CAF50': 'ğŸ’°',
                    '#FF9800': 'ğŸ”§',
                    '#f44336': 'âŒ',
                    '#2196F3': 'ğŸ®'
                };
                
                const icon = iconMap[color] || 'ğŸ®';
                document.getElementById('mode-icon').textContent = icon;
                document.getElementById('mode-label').textContent = label;
                document.getElementById('mode-indicator').style.background = color;
                document.getElementById('mode-text').textContent = label;
                document.getElementById('mode-text').style.color = color;
                
                if (color === '#4CAF50') {
                    document.getElementById('mode-indicator').classList.add('glow');
                } else {
                    document.getElementById('mode-indicator').classList.remove('glow');
                }
            }
            
            playCoinAnimation(adSlotId) {
                const earningElement = document.getElementById(`earnings${adSlotId}`);
                if (earningElement) {
                    earningElement.classList.remove('coin-animation');
                    void earningElement.offsetWidth;
                    earningElement.classList.add('coin-animation');
                    
                    setTimeout(() => {
                        earningElement.classList.remove('coin-animation');
                    }, 500);
                }
            }
            
            showNotification(message, color) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: ${color};
                    color: white;
                    padding: 12px 16px;
                    border-radius: 8px;
                    z-index: 10000;
                    font-size: 12px;
                    animation: slideIn 0.3s ease;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    max-width: 300px;
                    border-left: 4px solid rgba(255,255,255,0.3);
                `;
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
                
                // æ·»åŠ åŠ¨ç”»æ ·å¼
                if (!document.getElementById('notif-anim')) {
                    const style = document.createElement('style');
                    style.id = 'notif-anim';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            showError(message) {
                this.showNotification(message, '#f44336');
            }
        }
        
        // ========== æ¸¸æˆé€»è¾‘ ==========
        const adSystem = new RealUnityAdSystem();
        
        // å†·å´è®¡æ—¶å™¨
        setInterval(() => {
            if (gameData.adCooldowns && Array.isArray(gameData.adCooldowns)) {
                gameData.adCooldowns = gameData.adCooldowns.map(cd => 
                    cd > 0 ? cd - 1 : 0
                );
                updateCooldownDisplay();
            }
        }, 1000);
        
        // æ˜¾ç¤ºå¹¿å‘Š
        async function showAd(adIndex) {
            adIndex = parseInt(adIndex);
            if (isNaN(adIndex) || adIndex < 1 || adIndex > 3) return;
            
            const adId = adIndex - 1;
            
            if (gameData.adCooldowns[adId] > 0) {
                alert(`å¹¿å‘Šå†·å´ä¸­ï¼Œè¯·ç­‰å¾… ${gameData.adCooldowns[adId]} ç§’`);
                return;
            }
            
            const btn = document.getElementById(`btn${adIndex}`);
            const statusEl = document.getElementById(`status${adIndex}`);
            const originalText = btn.innerHTML;
            
            try {
                btn.disabled = true;
                btn.innerHTML = 'â³ åŠ è½½ä¸­...';
                statusEl.innerHTML = 'â³ å‡†å¤‡å¹¿å‘Š...';
                statusEl.className = 'ad-status-column';
                
                console.log(`ğŸ“¡ è¯·æ±‚å¹¿å‘Šä½ ${adIndex}`);
                const result = await adSystem.showAd(adIndex);
                
                if (result.success) {
                    if (result.isRealAd) {
                        statusEl.innerHTML = 'âœ… çœŸå®å®Œæˆ';
                        statusEl.className = 'ad-status-column ready';
                        console.log('ğŸ’° çœŸå®æ”¶ç›Šå·²è®¡å…¥Unityåå°');
                    } else {
                        statusEl.innerHTML = 'âœ… å®Œæˆ';
                        statusEl.className = 'ad-status-column ready';
                    }
                    
                } else {
                    statusEl.innerHTML = `âš ï¸ ${result.message}`;
                    statusEl.className = 'ad-status-column cooldown';
                }
                
            } catch (error) {
                console.error('å¹¿å‘Šå¼‚å¸¸:', error);
                statusEl.innerHTML = 'âŒ å¹¿å‘Šå¤±è´¥';
                statusEl.className = 'ad-status-column cooldown';
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }, 1000);
            }
        }
        
        // æ›´æ–°å†·å´æ˜¾ç¤º
        function updateCooldownDisplay() {
            if (!gameData.adCooldowns) return;
            
            for (let i = 0; i < 3; i++) {
                const statusEl = document.getElementById(`status${i + 1}`);
                const btn = document.getElementById(`btn${i + 1}`);
                
                if (!statusEl || !btn) continue;
                
                const cd = gameData.adCooldowns[i];
                if (cd > 0) {
                    statusEl.innerHTML = `â³ ${cd}ç§’`;
                    statusEl.className = 'ad-status-column cooldown';
                    btn.disabled = true;
                    btn.innerHTML = `å†·å´ä¸­`;
                } else {
                    statusEl.innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    statusEl.className = 'ad-status-column ready';
                    btn.disabled = false;
                    btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
                }
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            // åŸºç¡€ç»Ÿè®¡
            document.getElementById('impressions').textContent = gameData.impressions;
            document.getElementById('todayEarnings').textContent = '$' + gameData.todayEarnings.toFixed(2);
            document.getElementById('totalEarnings').textContent = '$' + gameData.totalEarnings.toFixed(2);
            
            // ç‚¹å‡»ç‡
            const clickRate = gameData.impressions > 0 ? 
                ((gameData.clicks / gameData.impressions) * 100).toFixed(1) : 0;
            document.getElementById('clickRate').textContent = clickRate + '%';
            
            // å„å¹¿å‘Šä½æ”¶ç›Š
            for (let i = 0; i < 3; i++) {
                const el = document.getElementById(`earnings${i + 1}`);
                if (el) el.textContent = '$' + gameData.adEarnings[i].toFixed(2);
            }
            
            // æ›´æ–°å½“å‰æ—¥æœŸ
            document.getElementById('currentDate').textContent = gameData.todayDate;
            
            saveGameData();
        }
        
        // æ›´æ–°æ—¥æ”¶ç›Šè®°å½•
        function updateDailyRecords() {
            const tbody = document.getElementById('dailyRecords');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (gameData.dailyRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="color:#aaa;text-align:center;padding:20px;">
                            æš‚æ— æ”¶ç›Šè®°å½•ï¼Œç‚¹å‡»å¹¿å‘Šå¼€å§‹èµšé’±ï¼
                        </td>
                    </tr>
                `;
                return;
            }
            
            gameData.dailyRecords.forEach(dateGroup => {
                dateGroup.records.forEach((record, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index === 0 ? dateGroup.date : ''}</td>
                        <td>${record.time}</td>
                        <td>å¹¿å‘Šä½ ${record.adSlot}</td>
                        <td style="color: ${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'}; font-weight: bold;">
                            $${record.earnings}
                        </td>
                        <td>
                            <span style="display:inline-block; padding:2px 8px; border-radius:12px; font-size:10px; background:${record.type === 'çœŸå®' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 152, 0, 0.2)'}; color:${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'};">
                                ${record.type}
                            </span>
                        </td>
                        <td>
                            <span style="display:inline-block; padding:2px 8px; border-radius:12px; font-size:10px; background:rgba(76, 175, 80, 0.2); color:#4CAF50;">
                                ${record.status}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }
        
        // ä¿å­˜æ•°æ®
        function saveGameData() {
            try {
                localStorage.setItem('adGameData', JSON.stringify(gameData));
            } catch (error) {
                console.log('ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ•°æ®
        function loadGameData() {
            try {
                const saved = localStorage.getItem('adGameData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    const today = new Date().toLocaleDateString('zh-CN');
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©çš„æ•°æ®
                    if (parsed.todayDate !== today) {
                        parsed.todayEarnings = 0;
                        parsed.todayDate = today;
                        parsed.adCooldowns = [0, 0, 0];
                    }
                    
                    gameData = {
                        ...gameData,
                        ...parsed,
                        adCooldowns: Array.isArray(parsed.adCooldowns) ? parsed.adCooldowns : [0, 0, 0],
                        adEarnings: Array.isArray(parsed.adEarnings) ? parsed.adEarnings : [0, 0, 0],
                        adCounts: Array.isArray(parsed.adCounts) ? parsed.adCounts : [0, 0, 0],
                        dailyRecords: Array.isArray(parsed.dailyRecords) ? parsed.dailyRecords : []
                    };
                    
                    updateStats();
                    updateDailyRecords();
                    updateCooldownDisplay();
                }
            } catch (error) {
                console.log('åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // ========== æ§åˆ¶åŠŸèƒ½ ==========
        window.testUnityConnection = function() {
            if (typeof unityads === 'undefined') {
                alert('âŒ Unity SDKæœªåŠ è½½\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢');
                return;
            }
            
            const isInitialized = unityads.gameId === CONFIG.unityGameId;
            const isRealMode = !unityads.testMode;
            
            let message = '';
            if (isInitialized && isRealMode) {
                message = 'âœ… Unityè¿æ¥æ­£å¸¸\nğŸ’° çœŸå®æ”¶ç›Šæ¨¡å¼å·²å¯ç”¨\nğŸ“Š æ”¶ç›Šè®¡å…¥Unityåå°';
            } else if (isInitialized && !isRealMode) {
                message = 'âš ï¸ Unityè¿æ¥æ­£å¸¸\nğŸ§ª å½“å‰ä¸ºæµ‹è¯•æ¨¡å¼\nğŸ”§ è¯·ä¿®æ”¹testMode: false';
            } else {
                message = 'âŒ Unityæœªæ­£ç¡®åˆå§‹åŒ–\nè¯·åˆ·æ–°é¡µé¢é‡è¯•';
            }
            
            alert(message);
        };
        
        window.showAllAds = function() {
            for (let i = 1; i <= 3; i++) {
                if (gameData.adCooldowns[i - 1] === 0) {
                    setTimeout(() => showAd(i), i * 1500);
                }
            }
        };
        
        window.resetGame = function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ¸¸æˆæ•°æ®å—ï¼Ÿ\nâš ï¸ è¿™å°†æ¸…ç©ºæ‰€æœ‰ç»Ÿè®¡å’Œè®°å½•')) {
                const today = new Date().toLocaleDateString('zh-CN');
                gameData = {
                    impressions: 0,
                    clicks: 0,
                    todayEarnings: 0,
                    totalEarnings: 0,
                    realEarnings: 0,
                    adCooldowns: [0, 0, 0],
                    adEarnings: [0, 0, 0],
                    adCounts: [0, 0, 0],
                    dailyRecords: [],
                    unityAvailable: gameData.unityAvailable,
                    unityInitialized: gameData.unityInitialized,
                    todayDate: today,
                    startDate: gameData.startDate,
                    version: '2.0'
                };
                
                updateStats();
                updateDailyRecords();
                updateCooldownDisplay();
                
                // é‡ç½®UI
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`earnings${i}`).textContent = '$0.00';
                    document.getElementById(`status${i}`).innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    document.getElementById(`status${i}`).className = 'ad-status-column ready';
                }
                
                alert('âœ… æ¸¸æˆæ•°æ®å·²é‡ç½®ï¼');
                console.log('ğŸ”„ æ¸¸æˆæ•°æ®å·²é‡ç½®');
            }
        };
        
        window.checkUnityDashboard = function() {
            window.open('https://dashboard.unity3d.com/', '_blank');
        };
        
        window.exportData = function() {
            const dataStr = JSON.stringify(gameData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `unity-earnings-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('âœ… æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
        };
        
        // ========== é¡µé¢åŠ è½½ ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ çœŸå®æ”¶ç›Šæ¸¸æˆåŠ è½½å®Œæˆ');
            console.log('ğŸ‘¤ å¼€å‘è€…: youmeng00000');
            console.log('ğŸŒ éƒ¨ç½²å¹³å°: Vercel');
            console.log('ğŸ¯ æ¨¡å¼: ' + (CONFIG.testMode ? 'æµ‹è¯•æ¨¡å¼' : 'çœŸå®æ”¶ç›Šæ¨¡å¼'));
            console.log('ğŸ’° Unity Game ID:', CONFIG.unityGameId);
            console.log('ğŸ“Š å¹¿å‘Šå•å…ƒ:', Object.values(CONFIG.unityAdUnits));
            
            // åŠ è½½æ¸¸æˆæ•°æ®
            loadGameData();
            
            // æ›´æ–°æ—¥æ”¶ç›Šè¡¨æ ¼
            updateDailyRecords();
            
            // è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
            setInterval(saveGameData, 30000);
            
            // æ£€æŸ¥UnityçŠ¶æ€
            setTimeout(() => {
                if (typeof unityads !== 'undefined' && unityads.gameId) {
                    console.log('âœ… Unity SDKçŠ¶æ€: å·²åŠ è½½');
                    console.log('ğŸ® Unityæ¨¡å¼:', unityads.testMode ? 'æµ‹è¯•æ¨¡å¼' : 'çœŸå®æ”¶ç›Šæ¨¡å¼');
                    
                    if (!unityads.testMode) {
                        console.log('ğŸ’° çœŸå®æ”¶ç›Šæ¨¡å¼å·²æ¿€æ´»ï¼');
                        adSystem.updateModeDisplay('ğŸ’° çœŸå®æ”¶ç›Š', '#4CAF50');
                    } else {
                        console.warn('âš ï¸ å½“å‰å¤„äºæµ‹è¯•æ¨¡å¼ï¼Œä¸ä¼šäº§ç”ŸçœŸå®æ”¶ç›Šï¼');
                        adSystem.updateModeDisplay('ğŸ§ª æµ‹è¯•æ¨¡å¼', '#FF9800');
                    }
                } else {
                    console.warn('âš ï¸ Unity SDKæœªæ­£ç¡®åŠ è½½');
                    adSystem.updateModeDisplay('âŒ SDKé”™è¯¯', '#f44336');
                }
            }, 2000);
            
            console.log('âœ… çœŸå®æ”¶ç›Šæ¸¸æˆå°±ç»ª');
        });
        
        // è‡ªåŠ¨ä¿å­˜
        window.addEventListener('beforeunload', saveGameData);
    </script>
</body>
</html>
