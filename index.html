<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å‘Šæ”¶ç›Šæ¸¸æˆ - çœŸå®æ”¶ç›Šä¸“ä¸šç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            padding: 15px;
            min-height: 100vh;
        }
        
        /* ä¸‰çª„åˆ—å¸ƒå±€ */
        .narrow-columns {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .narrow-window {
            width: 1cm;          /* 1å˜ç±³å®½ */
            min-height: 5cm;     /* 5å˜ç±³é«˜ */
            background: white;
            border-radius: 6px;
            padding: 6px 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 3px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .narrow-window:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .window-header {
            width: 100%;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .window-number {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 10px;
            line-height: 18px;
            font-weight: bold;
        }
        
        .window-content {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 3px 0;
        }
        
        .ad-status-narrow {
            width: 100%;
            min-height: 35px;
            background: #f8f9fa;
            border-radius: 4px;
            padding: 4px;
            margin: 3px 0;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-break: break-word;
            border: 1px solid #e9ecef;
        }
        
        .earnings-display {
            font-size: 8px;
            color: #666;
            margin: 2px 0;
        }
        
        .earnings-amount {
            color: #4CAF50;
            font-weight: bold;
            font-size: 9px;
        }
        
        .ad-btn-narrow {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 5px 0;
            border-radius: 12px;
            font-size: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 4px;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }
        
        .ad-btn-narrow:hover {
            transform: scale(1.03);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        .ad-btn-narrow:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* æ”¶ç›Šç»Ÿè®¡é¢æ¿ */
        .stats-panel-narrow {
            background: white;
            border-radius: 12px;
            padding: 15px;
            max-width: 400px;
            margin: 0 auto 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .stats-header {
            text-align: center;
            color: #333;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .stats-grid-narrow {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .stat-item-narrow {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            border-left: 3px solid #4CAF50;
        }
        
        .stat-label-narrow {
            font-size: 9px;
            color: #666;
            margin-bottom: 3px;
        }
        
        .stat-value-narrow {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        /* æ—¥æ”¶ç›Šè¡¨æ ¼ */
        .daily-stats-narrow {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }
        
        .daily-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .daily-title {
            font-size: 11px;
            font-weight: bold;
            color: #333;
        }
        
        .daily-date {
            font-size: 9px;
            color: #666;
        }
        
        .daily-table-narrow {
            width: 100%;
            font-size: 9px;
            border-collapse: collapse;
        }
        
        .daily-table-narrow th {
            background: #f1f3f4;
            padding: 4px;
            text-align: center;
            font-weight: bold;
            color: #333;
        }
        
        .daily-table-narrow td {
            padding: 4px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel-narrow {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            max-width: 180px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .control-title {
            font-size: 9px;
            color: #666;
            margin-bottom: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .control-btn-narrow {
            background: #2196F3;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 8px;
            margin: 2px 1px;
            cursor: pointer;
            width: calc(50% - 2px);
            display: inline-block;
            transition: all 0.2s;
        }
        
        .control-btn-narrow:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(33, 150, 243, 0.3);
        }
        
        .control-btn-narrow.test {
            background: #FF9800;
        }
        
        .control-btn-narrow.reset {
            background: #f44336;
        }
        
        .control-btn-narrow.dashboard {
            background: #9C27B0;
        }
        
        /* æ¨¡å¼æŒ‡ç¤ºå™¨ */
        .mode-indicator-narrow {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 9px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .narrow-window {
                width: 28px;
                min-height: 140px;
            }
            
            .stats-panel-narrow {
                max-width: 95%;
            }
            
            .control-panel-narrow {
                max-width: 160px;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes coinBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .coin-animation {
            animation: coinBounce 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
    
    <!-- Unity Ads SDK -->
    <script src="https://cdn.unityads.unity3d.com/unity-ads-sdk.js"></script>
</head>
<body>
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel-narrow fade-in">
        <div class="control-title">ğŸ® æ§åˆ¶ä¸­å¿ƒ</div>
        <button class="control-btn-narrow test" onclick="testUnityConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
        <button class="control-btn-narrow" onclick="showAllAds()">ğŸš€ ä¸€é”®æµ‹è¯•</button>
        <button class="control-btn-narrow reset" onclick="resetGame()">ğŸ”„ é‡ç½®</button>
        <button class="control-btn-narrow dashboard" onclick="checkUnityDashboard()">ğŸ“Š åå°</button>
        <div style="font-size: 8px; color: #888; margin-top: 4px; text-align: center;">
            æ¨¡å¼: <span id="mode-text" style="color: #4CAF50; font-weight: bold;">æ£€æµ‹ä¸­...</span>
        </div>
    </div>
    
    <!-- æ¨¡å¼æŒ‡ç¤ºå™¨ -->
    <div class="mode-indicator-narrow fade-in" id="mode-indicator">
        <span id="mode-icon">ğŸ®</span>
        <span id="mode-label">æ£€æµ‹ä¸­</span>
    </div>
    
    <!-- ä¸‰çª„åˆ—å¹¿å‘Šçª—å£ -->
    <div class="narrow-columns fade-in">
        <div class="narrow-window">
            <div class="window-header">
                <div class="window-number">1</div>
            </div>
            <div class="window-content">
                <div class="ad-status-narrow" id="status1">ğŸ” åˆå§‹åŒ–...</div>
                <div class="earnings-display">
                    æ”¶ç›Š: <span class="earnings-amount" id="earnings1">$0.00</span>
                </div>
                <button class="ad-btn-narrow" onclick="showAd(1)" id="btn1">ğŸ¬ è§‚çœ‹å¹¿å‘Š</button>
            </div>
        </div>
        
        <div class="narrow-window">
            <div class="window-header">
                <div class="window-number">2</div>
            </div>
            <div class="window-content">
                <div class="ad-status-narrow" id="status2">ğŸ” åˆå§‹åŒ–...</div>
                <div class="earnings-display">
                    æ”¶ç›Š: <span class="earnings-amount" id="earnings2">$0.00</span>
                </div>
                <button class="ad-btn-narrow" onclick="showAd(2)" id="btn2">ğŸ¬ è§‚çœ‹å¹¿å‘Š</button>
            </div>
        </div>
        
        <div class="narrow-window">
            <div class="window-header">
                <div class="window-number">3</div>
            </div>
            <div class="window-content">
                <div class="ad-status-narrow" id="status3">ğŸ” åˆå§‹åŒ–...</div>
                <div class="earnings-display">
                    æ”¶ç›Š: <span class="earnings-amount" id="earnings3">$0.00</span>
                </div>
                <button class="ad-btn-narrow" onclick="showAd(3)" id="btn3">ğŸ¬ è§‚çœ‹å¹¿å‘Š</button>
            </div>
        </div>
    </div>
    
    <!-- æ”¶ç›Šç»Ÿè®¡é¢æ¿ -->
    <div class="stats-panel-narrow fade-in">
        <div class="stats-header">
            <span>ğŸ“Š</span>
            <span>æ”¶ç›Šç»Ÿè®¡é¢æ¿</span>
        </div>
        
        <div class="stats-grid-narrow">
            <div class="stat-item-narrow">
                <div class="stat-label-narrow">ä»Šæ—¥æ”¶ç›Š</div>
                <div class="stat-value-narrow" id="todayEarnings">$0.00</div>
            </div>
            <div class="stat-item-narrow">
                <div class="stat-label-narrow">ç´¯è®¡æ”¶ç›Š</div>
                <div class="stat-value-narrow" id="totalEarnings">$0.00</div>
            </div>
            <div class="stat-item-narrow">
                <div class="stat-label-narrow">å¹¿å‘Šå±•ç¤º</div>
                <div class="stat-value-narrow" id="impressions">0</div>
            </div>
            <div class="stat-item-narrow">
                <div class="stat-label-narrow">ç‚¹å‡»ç‡</div>
                <div class="stat-value-narrow" id="clickRate">0%</div>
            </div>
        </div>
        
        <!-- æ—¥æ”¶ç›Šè¡¨æ ¼ -->
        <div class="daily-stats-narrow">
            <div class="daily-header">
                <div class="daily-title">ğŸ“… æ—¥æ”¶ç›Šè®°å½•</div>
                <div class="daily-date" id="currentDate">ä»Šå¤©</div>
            </div>
            <table class="daily-table-narrow">
                <thead>
                    <tr>
                        <th>æ—¶é—´</th>
                        <th>å¹¿å‘Šä½</th>
                        <th>æ”¶ç›Š</th>
                        <th>ç±»å‹</th>
                    </tr>
                </thead>
                <tbody id="dailyRecords">
                    <tr><td colspan="4" style="color:#999;text-align:center;">æš‚æ— è®°å½•</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ========== çœŸå®æ”¶ç›Šé…ç½® ==========
        const CONFIG = {
            // UnityçœŸå®é…ç½®
            unityGameId: '6028834',
            unityAdUnits: {
                rewarded1: 'youmeng1',
                rewarded2: 'youmeng2',
                rewarded3: 'youmeng3'
            },
            
            // ğŸš€ çœŸå®æ”¶ç›Šæ¨¡å¼
            useRealUnityAds: true,  // true = UnityçœŸå®å¹¿å‘Š
            
            // æ¸¸æˆè®¾ç½®
            adCooldown: 30,         // å†·å´æ—¶é—´
            estimatedEarnings: 0.35 // é¢„ä¼°æ”¶ç›Š
        };
        
        // ========== æ¸¸æˆæ•°æ® ==========
        let gameData = {
            // åŸºç¡€ç»Ÿè®¡
            impressions: 0,
            clicks: 0,
            todayEarnings: 0,
            totalEarnings: 0,
            realEarnings: 0,       // çœŸå®æ”¶ç›Šï¼ˆå¦‚æœæœ‰ï¼‰
            
            // å¹¿å‘Šä½æ•°æ®
            adCooldowns: [0, 0, 0],
            adEarnings: [0, 0, 0],
            adCounts: [0, 0, 0],
            
            // æ—¥æ”¶ç›Šè®°å½•
            dailyRecords: [],
            
            // UnityçŠ¶æ€
            unityAvailable: false,
            unityInitialized: false,
            
            // å…ƒæ•°æ®
            todayDate: new Date().toLocaleDateString('zh-CN'),
            startDate: new Date().toISOString().split('T')[0]
        };
        
        // ========== UnityçœŸå®å¹¿å‘Šç³»ç»Ÿ ==========
        class RealUnityAdSystem {
            constructor() {
                this.isRealMode = CONFIG.useRealUnityAds;
                this.init();
            }
            
            async init() {
                console.log('ğŸ® UnityçœŸå®å¹¿å‘Šç³»ç»Ÿåˆå§‹åŒ–...');
                
                // æ›´æ–°æ¨¡å¼æ˜¾ç¤º
                this.updateModeDisplay('ğŸ® åˆå§‹åŒ–ä¸­...', '#FF9800');
                
                if (this.isRealMode && typeof unityads !== 'undefined') {
                    await this.initializeUnityAds();
                } else {
                    setTimeout(() => {
                        this.attemptLoadUnitySDK();
                    }, 1000);
                }
                
                // åˆå§‹åŒ–å®Œæˆ
                this.updateAdStatus('âœ… å‡†å¤‡å°±ç»ª');
            }
            
            async attemptLoadUnitySDK() {
                try {
                    console.log('ğŸ“¡ å°è¯•åŠ è½½Unity SDK...');
                    
                    if (typeof unityads === 'undefined') {
                        console.log('ğŸ”§ Unity SDKæœªåŠ è½½ï¼Œç­‰å¾…SDK...');
                        this.updateModeDisplay('ğŸ”„ åŠ è½½SDK...', '#2196F3');
                        return;
                    }
                    
                    await this.initializeUnityAds();
                } catch (error) {
                    console.error('âŒ Unity SDKåŠ è½½å¤±è´¥:', error);
                    this.updateModeDisplay('ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼', '#FF9800');
                    this.updateAdStatus('ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼å°±ç»ª');
                }
            }
            
            async initializeUnityAds() {
                return new Promise((resolve) => {
                    console.log('ğŸ”— åˆå§‹åŒ–UnityçœŸå®å¹¿å‘Š...');
                    
                    if (typeof unityads === 'undefined') {
                        console.log('âŒ unityadså¯¹è±¡æœªå®šä¹‰');
                        resolve(false);
                        return;
                    }
                    
                    unityads.init(CONFIG.unityGameId, {
                        testMode: false,  // ğŸš¨ çœŸå®æ”¶ç›Šæ¨¡å¼ï¼
                        onInitialized: () => {
                            console.log('ğŸ‰ UnityçœŸå®å¹¿å‘Šåˆå§‹åŒ–æˆåŠŸï¼');
                            console.log('ğŸ’° ç°åœ¨å¼€å§‹äº§ç”ŸçœŸå®ç¾å…ƒæ”¶ç›Šï¼');
                            
                            gameData.unityAvailable = true;
                            gameData.unityInitialized = true;
                            
                            this.updateModeDisplay('ğŸ’° çœŸå®æ”¶ç›Š', '#4CAF50');
                            this.updateAdStatus('ğŸ’° çœŸå®å¹¿å‘Šå°±ç»ª');
                            this.showNotification('ğŸ‰ UnityçœŸå®æ”¶ç›Šæ¨¡å¼å·²å¯ç”¨ï¼', '#4CAF50');
                            
                            resolve(true);
                        },
                        onFailed: (error) => {
                            console.error('âŒ Unityåˆå§‹åŒ–å¤±è´¥:', error);
                            this.updateModeDisplay('ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼', '#FF9800');
                            this.updateAdStatus('ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼å°±ç»ª');
                            resolve(false);
                        }
                    });
                    
                    // è¶…æ—¶ä¿æŠ¤
                    setTimeout(() => {
                        console.log('â° Unityåˆå§‹åŒ–è¶…æ—¶');
                        this.updateModeDisplay('ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼', '#FF9800');
                        this.updateAdStatus('ğŸ¬ æ¨¡æ‹Ÿæ¨¡å¼å°±ç»ª');
                        resolve(false);
                    }, 10000);
                });
            }
            
            async showAd(adSlotId) {
                if (gameData.unityAvailable && gameData.unityInitialized) {
                    console.log(`ğŸ¬ å±•ç¤ºçœŸå®Unityå¹¿å‘Š ${adSlotId}`);
                    return this.showRealUnityAd(adSlotId);
                } else {
                    console.log(`ğŸ¬ Unityä¸å¯ç”¨ï¼Œå±•ç¤ºæ¨¡æ‹Ÿå¹¿å‘Š ${adSlotId}`);
                    return this.showMockAd(adSlotId);
                }
            }
            
            async showRealUnityAd(adSlotId) {
                return new Promise((resolve, reject) => {
                    console.log(`ğŸ’° è¯·æ±‚çœŸå®Unityå¹¿å‘Š ${adSlotId}`);
                    
                    const adUnitId = CONFIG.unityAdUnits[`rewarded${adSlotId}`];
                    
                    unityads.show(adUnitId, {
                        onClosed: (result) => {
                            if (result && result.completed) {
                                console.log('âœ… ç”¨æˆ·å®Œæˆè§‚çœ‹çœŸå®Unityå¹¿å‘Š');
                                console.log('ğŸ’° çœŸå®æ”¶ç›Šå·²è®¡å…¥Unityåå°è´¦æˆ·');
                                console.log('ğŸ“Š ç™»å½• https://dashboard.unity3d.com æŸ¥çœ‹æ•°æ®');
                                
                                // è®°å½•åˆ°æœ¬åœ°ç»Ÿè®¡
                                this.recordAdComplete(adSlotId, true);
                                
                                resolve({
                                    success: true,
                                    isRealAd: true,
                                    earnings: CONFIG.estimatedEarnings,
                                    message: 'çœŸå®å¹¿å‘Šå®Œæˆï¼æ”¶ç›Šè®¡å…¥Unityåå°'
                                });
                            } else {
                                console.log('âš ï¸ ç”¨æˆ·æœªå®Œæˆå¹¿å‘Šè§‚çœ‹');
                                resolve({
                                    success: false,
                                    message: 'å¹¿å‘Šæœªå®Œæˆè§‚çœ‹'
                                });
                            }
                        },
                        onFailed: (error) => {
                            console.error('âŒ çœŸå®å¹¿å‘Šå±•ç¤ºå¤±è´¥:', error);
                            
                            // å¤±è´¥æ—¶å›é€€åˆ°æ¨¡æ‹Ÿå¹¿å‘Š
                            console.log('ğŸ”„ åˆ‡æ¢åˆ°æ¨¡æ‹Ÿå¹¿å‘Š...');
                            this.showMockAd(adSlotId).then(resolve).catch(reject);
                        }
                    });
                });
            }
            
            async showMockAd(adSlotId) {
                return new Promise((resolve) => {
                    console.log(`ğŸ¬ å±•ç¤ºæ¨¡æ‹Ÿå¹¿å‘Š ${adSlotId}`);
                    
                    // åˆ›å»ºæ¨¡æ‹Ÿå¹¿å‘Šç•Œé¢
                    this.createMockAdInterface(adSlotId, resolve);
                });
            }
            
            createMockAdInterface(adSlotId, resolve) {
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0; left: 0;
                    width: 100%; height: 100%;
                    background: rgba(0,0,0,0.95);
                    z-index: 9999;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    animation: fadeIn 0.3s ease;
                `;
                
                const earnings = this.calculateMockEarnings(adSlotId);
                
                overlay.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: white; border-radius: 15px; padding: 20px; max-width: 320px; width: 90%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                        <h3 style="margin: 0 0 15px 0; color: #4CAF50;">ğŸ¬ æ¨¡æ‹Ÿå¹¿å‘Šæ¼”ç¤º</h3>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="opacity: 0.8;">å¹¿å‘Šä½:</span>
                                <span style="font-weight: bold;">#${adSlotId}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="opacity: 0.8;">é¢„ä¼°æ”¶ç›Š:</span>
                                <span style="color: #4CAF50; font-weight: bold;">$${earnings.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="opacity: 0.8;">å¹¿å‘ŠID:</span>
                                <span style="font-size: 10px;">AD${Date.now().toString().slice(-8)}</span>
                            </div>
                        </div>
                        
                        <!-- æ¨¡æ‹Ÿè§†é¢‘åŒºåŸŸ -->
                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                                    ğŸ“±
                                </div>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold; font-size: 12px;">æ¸¸æˆæ¨å¹¿å¹¿å‘Š</div>
                                    <div style="font-size: 10px; opacity: 0.8;">30ç§’æ¼”ç¤ºè§†é¢‘</div>
                                </div>
                            </div>
                            
                            <div style="width: 100%; background: rgba(255,255,255,0.1); height: 4px; border-radius: 2px; margin-bottom: 10px;">
                                <div id="mock-progress" style="width: 0%; height: 100%; background: #4CAF50; border-radius: 2px; transition: width 1s linear;"></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; font-size: 11px; opacity: 0.8;">
                                <span>å‰©ä½™æ—¶é—´: <span id="mock-timer">30</span>ç§’</span>
                                <span>è·³è¿‡: 5ç§’å</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button id="mock-skip" style="flex: 1; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px; border-radius: 8px; cursor: not-allowed; font-size: 12px;">
                                è·³è¿‡ (<span id="skip-count">5</span>ç§’)
                            </button>
                            <button id="mock-complete" style="flex: 2; background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 12px;">
                                ç«‹å³å®Œæˆ (+$${earnings.toFixed(2)})
                            </button>
                        </div>
                        
                        <div style="margin-top: 15px; font-size: 10px; opacity: 0.6;">
                            çœŸå®æ¨¡å¼ä¸‹ä¼šæ˜¾ç¤ºUnityç½‘ç»œå¹¿å‘Š
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                let timeLeft = 30;
                let skipTimeLeft = 5;
                const timerEl = document.getElementById('mock-timer');
                const progressEl = document.getElementById('mock-progress');
                const skipEl = document.getElementById('skip-count');
                let timerInterval;
                
                function updateTimer() {
                    timeLeft--;
                    timerEl.textContent = timeLeft;
                    const progress = ((30 - timeLeft) / 30) * 100;
                    progressEl.style.width = `${progress}%`;
                    
                    // æ›´æ–°è·³è¿‡æ—¶é—´
                    if (skipTimeLeft > 0) {
                        skipTimeLeft--;
                        skipEl.textContent = skipTimeLeft;
                        
                        if (skipTimeLeft <= 0) {
                            document.getElementById('mock-skip').style.cursor = 'pointer';
                            document.getElementById('mock-skip').style.background = 'rgba(255, 152, 0, 0.3)';
                            document.getElementById('mock-skip').innerHTML = 'è·³è¿‡å¹¿å‘Š';
                        }
                    }
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        completeAd();
                    }
                }
                
                timerInterval = setInterval(updateTimer, 1000);
                
                function completeAd() {
                    document.body.removeChild(overlay);
                    
                    // è®°å½•å¹¿å‘Šå®Œæˆ
                    adSystem.recordAdComplete(adSlotId, false, earnings);
                    
                    resolve({
                        success: true,
                        isRealAd: false,
                        earnings: earnings,
                        message: 'æ¨¡æ‹Ÿå¹¿å‘Šå®Œæˆ'
                    });
                }
                
                // è·³è¿‡æŒ‰é’®
                document.getElementById('mock-skip').onclick = function() {
                    if (skipTimeLeft > 0) return;
                    clearInterval(timerInterval);
                    document.body.removeChild(overlay);
                    
                    resolve({
                        success: false,
                        message: 'ç”¨æˆ·è·³è¿‡å¹¿å‘Š'
                    });
                };
                
                // å®ŒæˆæŒ‰é’®
                document.getElementById('mock-complete').onclick = completeAd;
            }
            
            calculateMockEarnings(adSlotId) {
                const base = CONFIG.estimatedEarnings;
                const randomFactor = 0.8 + Math.random() * 0.4;
                const slotFactor = adSlotId === 1 ? 1.0 : adSlotId === 2 ? 0.9 : 0.8;
                
                return base * randomFactor * slotFactor;
            }
            
            recordAdComplete(adSlotId, isRealAd, earnings = null) {
                const adId = adSlotId - 1;
                const actualEarnings = earnings || CONFIG.estimatedEarnings;
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                gameData.impressions++;
                gameData.clicks++;
                gameData.todayEarnings += actualEarnings;
                gameData.totalEarnings += actualEarnings;
                gameData.adEarnings[adId] += actualEarnings;
                gameData.adCounts[adId]++;
                gameData.adCooldowns[adId] = CONFIG.adCooldown;
                
                if (isRealAd) {
                    gameData.realEarnings += actualEarnings;
                }
                
                // æ·»åŠ æ—¥è®°å½•
                this.addDailyRecord(adSlotId, actualEarnings, isRealAd);
                
                // æ›´æ–°UI
                updateStats();
                updateCooldownDisplay();
                updateDailyRecords();
                
                // æ’­æ”¾æ”¶ç›ŠåŠ¨ç”»
                this.playCoinAnimation(adSlotId);
                
                // æ›´æ–°å¹¿å‘Šä½çŠ¶æ€
                this.updateAdStatusForSlot(adSlotId, isRealAd);
            }
            
            addDailyRecord(adSlotId, earnings, isRealAd) {
                const today = new Date().toISOString().split('T')[0];
                const time = new Date().toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false 
                });
                
                // æŸ¥æ‰¾ä»Šå¤©çš„è®°å½•
                let dailyRecord = gameData.dailyRecords.find(record => record.date === today);
                
                if (!dailyRecord) {
                    dailyRecord = {
                        date: today,
                        impressions: 0,
                        earnings: 0,
                        realEarnings: 0,
                        records: []
                    };
                    gameData.dailyRecords.unshift(dailyRecord);
                }
                
                // æ›´æ–°æ—¥ç»Ÿè®¡
                dailyRecord.impressions++;
                dailyRecord.earnings += earnings;
                if (isRealAd) dailyRecord.realEarnings += earnings;
                
                // æ·»åŠ è¯¦ç»†è®°å½•
                dailyRecord.records.unshift({
                    time: time,
                    adSlot: adSlotId,
                    earnings: earnings.toFixed(2),
                    type: isRealAd ? 'çœŸå®' : 'æ¨¡æ‹Ÿ'
                });
                
                // é™åˆ¶è®°å½•æ•°é‡
                if (dailyRecord.records.length > 10) {
                    dailyRecord.records = dailyRecord.records.slice(0, 10);
                }
                
                if (gameData.dailyRecords.length > 7) {
                    gameData.dailyRecords = gameData.dailyRecords.slice(0, 7);
                }
            }
            
            updateAdStatusForSlot(adSlotId, isRealAd) {
                const statusEl = document.getElementById(`status${adSlotId}`);
                const earningsEl = document.getElementById(`earnings${adSlotId}`);
                
                if (statusEl && earningsEl) {
                    if (isRealAd) {
                        statusEl.innerHTML = 'ğŸ’° çœŸå®å®Œæˆ';
                        statusEl.style.color = '#4CAF50';
                    } else {
                        const earnings = gameData.adEarnings[adSlotId - 1];
                        earningsEl.textContent = `$${earnings.toFixed(2)}`;
                        earningsEl.classList.add('coin-animation');
                        setTimeout(() => earningsEl.classList.remove('coin-animation'), 300);
                    }
                }
            }
            
            updateAdStatus(message) {
                for (let i = 1; i <= 3; i++) {
                    const statusEl = document.getElementById(`status${i}`);
                    if (statusEl && statusEl.innerHTML.includes('åˆå§‹åŒ–')) {
                        statusEl.innerHTML = message;
                        statusEl.style.color = '#4CAF50';
                    }
                }
            }
            
            updateModeDisplay(label, color) {
                const icon = color === '#4CAF50' ? 'ğŸ’°' : color === '#FF9800' ? 'ğŸ¬' : 'ğŸ®';
                document.getElementById('mode-icon').textContent = icon;
                document.getElementById('mode-label').textContent = label;
                document.getElementById('mode-indicator').style.background = color;
                document.getElementById('mode-text').textContent = label;
                document.getElementById('mode-text').style.color = color;
            }
            
            playCoinAnimation(adSlotId) {
                const earningElement = document.getElementById(`earnings${adSlotId}`);
                if (earningElement) {
                    earningElement.classList.remove('coin-animation');
                    void earningElement.offsetWidth;
                    earningElement.classList.add('coin-animation');
                    
                    setTimeout(() => {
                        earningElement.classList.remove('coin-animation');
                    }, 500);
                }
            }
            
            showNotification(message, color) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50px;
                    right: 10px;
                    background: ${color};
                    color: white;
                    padding: 8px 12px;
                    border-radius: 6px;
                    z-index: 10000;
                    font-size: 10px;
                    animation: fadeIn 0.3s ease;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    max-width: 200px;
                `;
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
                
                // æ·»åŠ åŠ¨ç”»æ ·å¼
                if (!document.getElementById('notif-anim')) {
                    const style = document.createElement('style');
                    style.id = 'notif-anim';
                    style.textContent = `
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(-10px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        @keyframes fadeOut {
                            from { opacity: 1; transform: translateY(0); }
                            to { opacity: 0; transform: translateY(-10px); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        }
        
        // ========== æ¸¸æˆé€»è¾‘ ==========
        const adSystem = new RealUnityAdSystem();
        
        // å†·å´è®¡æ—¶å™¨
        setInterval(() => {
            if (gameData.adCooldowns && Array.isArray(gameData.adCooldowns)) {
                gameData.adCooldowns = gameData.adCooldowns.map(cd => 
                    cd > 0 ? cd - 1 : 0
                );
                updateCooldownDisplay();
            }
        }, 1000);
        
        // æ˜¾ç¤ºå¹¿å‘Š
        async function showAd(adIndex) {
            adIndex = parseInt(adIndex);
            if (isNaN(adIndex) || adIndex < 1 || adIndex > 3) return;
            
            const adId = adIndex - 1;
            
            if (gameData.adCooldowns[adId] > 0) {
                alert(`å¹¿å‘Šå†·å´ä¸­ï¼Œè¯·ç­‰å¾… ${gameData.adCooldowns[adId]} ç§’`);
                return;
            }
            
            const btn = document.getElementById(`btn${adIndex}`);
            const statusEl = document.getElementById(`status${adIndex}`);
            const originalText = btn.innerHTML;
            
            try {
                btn.disabled = true;
                btn.innerHTML = 'â³ åŠ è½½ä¸­...';
                statusEl.innerHTML = 'â³ å‡†å¤‡å¹¿å‘Š...';
                statusEl.style.color = '#2196F3';
                
                console.log(`ğŸ“¡ è¯·æ±‚å¹¿å‘Šä½ ${adIndex}`);
                const result = await adSystem.showAd(adIndex);
                
                if (result.success) {
                    if (result.isRealAd) {
                        statusEl.innerHTML = 'âœ… çœŸå®å®Œæˆ';
                        statusEl.style.color = '#4CAF50';
                        console.log('ğŸ’° çœŸå®æ”¶ç›Šå·²è®¡å…¥Unityåå°');
                    } else {
                        statusEl.innerHTML = `âœ… æ¨¡æ‹Ÿå®Œæˆ`;
                        statusEl.style.color = '#4CAF50';
                    }
                    
                    statusEl.style.fontWeight = 'bold';
                    
                } else {
                    statusEl.innerHTML = `âš ï¸ ${result.message}`;
                    statusEl.style.color = '#FF9800';
                }
                
            } catch (error) {
                console.error('å¹¿å‘Šå¼‚å¸¸:', error);
                statusEl.innerHTML = 'âŒ å¹¿å‘Šå¤±è´¥';
                statusEl.style.color = '#f44336';
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }, 1000);
            }
        }
        
        // æ›´æ–°å†·å´æ˜¾ç¤º
        function updateCooldownDisplay() {
            if (!gameData.adCooldowns) return;
            
            for (let i = 0; i < 3; i++) {
                const statusEl = document.getElementById(`status${i + 1}`);
                const btn = document.getElementById(`btn${i + 1}`);
                
                if (!statusEl || !btn) continue;
                
                const cd = gameData.adCooldowns[i];
                if (cd > 0) {
                    statusEl.innerHTML = `â³ ${cd}ç§’`;
                    statusEl.style.color = '#ff9800';
                    btn.disabled = true;
                    btn.innerHTML = `å†·å´ä¸­`;
                } else {
                    statusEl.innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    statusEl.style.color = '#4CAF50';
                    btn.disabled = false;
                    btn.innerHTML = 'ğŸ¬ è§‚çœ‹å¹¿å‘Š';
                }
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            // åŸºç¡€ç»Ÿè®¡
            document.getElementById('impressions').textContent = gameData.impressions;
            document.getElementById('todayEarnings').textContent = '$' + gameData.todayEarnings.toFixed(2);
            document.getElementById('totalEarnings').textContent = '$' + gameData.totalEarnings.toFixed(2);
            
            // ç‚¹å‡»ç‡
            const clickRate = gameData.impressions > 0 ? 
                ((gameData.clicks / gameData.impressions) * 100).toFixed(1) : 0;
            document.getElementById('clickRate').textContent = clickRate + '%';
            
            // å„å¹¿å‘Šä½æ”¶ç›Š
            for (let i = 0; i < 3; i++) {
                const el = document.getElementById(`earnings${i + 1}`);
                if (el) el.textContent = gameData.adEarnings[i].toFixed(2);
            }
            
            // æ›´æ–°å½“å‰æ—¥æœŸ
            document.getElementById('currentDate').textContent = gameData.todayDate;
            
            saveGameData();
        }
        
        // æ›´æ–°æ—¥æ”¶ç›Šè®°å½•
        function updateDailyRecords() {
            const tbody = document.getElementById('dailyRecords');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const todayRecords = gameData.dailyRecords[0]?.records || [];
            
            if (todayRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="color:#999;text-align:center;">ä»Šå¤©æš‚æ— è®°å½•</td></tr>';
                return;
            }
            
            todayRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.time}</td>
                    <td>å¹¿å‘Šä½ ${record.adSlot}</td>
                    <td style="color: ${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'}; font-weight: bold;">
                        $${record.earnings}
                    </td>
                    <td style="font-size: 8px; color: ${record.type === 'çœŸå®' ? '#4CAF50' : '#FF9800'};">${record.type}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ä¿å­˜æ•°æ®
        function saveGameData() {
            try {
                localStorage.setItem('adGameData', JSON.stringify(gameData));
            } catch (error) {
                console.log('ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ•°æ®
        function loadGameData() {
            try {
                const saved = localStorage.getItem('adGameData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    const today = new Date().toLocaleDateString('zh-CN');
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©çš„æ•°æ®
                    if (parsed.todayDate !== today) {
                        parsed.todayEarnings = 0;
                        parsed.todayDate = today;
                        parsed.adCooldowns = [0, 0, 0];
                    }
                    
                    gameData = {
                        ...gameData,
                        ...parsed,
                        adCooldowns: Array.isArray(parsed.adCooldowns) ? parsed.adCooldowns : [0, 0, 0],
                        adEarnings: Array.isArray(parsed.adEarnings) ? parsed.adEarnings : [0, 0, 0],
                        adCounts: Array.isArray(parsed.adCounts) ? parsed.adCounts : [0, 0, 0],
                        dailyRecords: Array.isArray(parsed.dailyRecords) ? parsed.dailyRecords : []
                    };
                    
                    updateStats();
                    updateDailyRecords();
                    updateCooldownDisplay();
                }
            } catch (error) {
                console.log('åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // ========== æ§åˆ¶åŠŸèƒ½ ==========
        window.testUnityConnection = async function() {
            const result = await new Promise(resolve => {
                if (typeof unityads !== 'undefined') {
                    unityads.init(CONFIG.unityGameId, {
                        testMode: true,
                        onInitialized: () => {
                            resolve({
                                success: true,
                                message: 'ğŸ‰ Unityè¿æ¥æˆåŠŸï¼å¯ä»¥æ˜¾ç¤ºçœŸå®å¹¿å‘Šï¼\nğŸ’° åˆ‡æ¢åˆ°testMode: falseå¼€å§‹çœŸå®æ”¶ç›Šï¼'
                            });
                        },
                        onFailed: (error) => {
                            resolve({
                                success: false,
                                message: 'âŒ Unityåˆå§‹åŒ–å¤±è´¥: ' + error
                            });
                        }
                    });
                } else {
                    resolve({
                        success: false,
                        message: 'âŒ Unity SDKæœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•'
                    });
                }
            });
            
            alert(result.message);
        };
        
        window.showAllAds = function() {
            for (let i = 1; i <= 3; i++) {
                if (gameData.adCooldowns[i - 1] === 0) {
                    setTimeout(() => showAd(i), i * 1000);
                }
            }
        };
        
        window.resetGame = function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ¸¸æˆæ•°æ®å—ï¼Ÿ')) {
                const today = new Date().toLocaleDateString('zh-CN');
                gameData = {
                    impressions: 0,
                    clicks: 0,
                    todayEarnings: 0,
                    totalEarnings: 0,
                    realEarnings: 0,
                    adCooldowns: [0, 0, 0],
                    adEarnings: [0, 0, 0],
                    adCounts: [0, 0, 0],
                    dailyRecords: [],
                    unityAvailable: gameData.unityAvailable,
                    unityInitialized: gameData.unityInitialized,
                    todayDate: today,
                    startDate: gameData.startDate
                };
                
                updateStats();
                updateDailyRecords();
                updateCooldownDisplay();
                
                // é‡ç½®å¹¿å‘Šä½çŠ¶æ€
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`earnings${i}`).textContent = '$0.00';
                    document.getElementById(`status${i}`).innerHTML = 'âœ… å‡†å¤‡å°±ç»ª';
                    document.getElementById(`status${i}`).style.color = '#4CAF50';
                }
                
                alert('æ¸¸æˆæ•°æ®å·²é‡ç½®ï¼');
                console.log('ğŸ”„ æ¸¸æˆæ•°æ®å·²é‡ç½®');
            }
        };
        
        window.checkUnityDashboard = function() {
            window.open('https://dashboard.unity3d.com/', '_blank');
        };
        
        // ========== é¡µé¢åŠ è½½ ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ çœŸå®æ”¶ç›Šæ¸¸æˆåŠ è½½');
            console.log('ğŸ‘¤ å¼€å‘è€…: youmeng00000');
            console.log('ğŸŒ éƒ¨ç½²å¹³å°: Vercel ğŸš€');
            console.log('ğŸ¯ æ¨¡å¼: ' + (CONFIG.useRealUnityAds ? 'çœŸå®æ”¶ç›Šæ¨¡å¼' : 'æ¨¡æ‹Ÿæ¨¡å¼'));
            console.log('ğŸ’° Unity Game ID:', CONFIG.unityGameId);
            console.log('ğŸ“Š å¹¿å‘Šå•å…ƒ:', Object.values(CONFIG.unityAdUnits).join(', '));
            
            // åŠ è½½æ¸¸æˆæ•°æ®
            loadGameData();
            
            // æ›´æ–°æ—¥æ”¶ç›Šè¡¨æ ¼
            updateDailyRecords();
            
            // è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
            setInterval(saveGameData, 30000);
            
            console.log('âœ… çœŸå®æ”¶ç›Šæ¸¸æˆå°±ç»ª');
        });
        
        // è‡ªåŠ¨ä¿å­˜
        window.addEventListener('beforeunload', saveGameData);
    </script>
</body>
</html>
